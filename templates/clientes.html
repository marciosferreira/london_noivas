{% extends "base.html" %} {% block title %}Clientes{% endblock %}{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='style_clientes.css') }}" />
{% endblock %} {% block content %}

<div class="container my-3">
  <h2 class="mb-4">Clientes cadastrados</h2>

  {% set show_add_button = True %} {% set add_route = url_for('add_item') %} {% include "components/client_filter_section.html" with context %} {% if
  itens %}

  <!-- Tabela (que vira "cards" no mobile) -->
    <!-- Tabela -->
    <div class="table-container mt-4">
      <table class="table table-hover responsive-table align-middle rounded-table">
        <thead>
          <tr>
            <th></th>
            <th>Nome</th>
            <th>Criado em</th>
            <th>Telefone</th>
            <th>Observa√ß√µes C.</th>

            <th class="text-center"></th>
            <!-- üîß Aqui -->
          </tr>
        </thead>
        <tbody>
          {% if itens %} {% for item in itens %}
          <tr>
            <td>
              <img src="{{ url_for('static', filename='icons/user-icon.png') }}" alt="√çcone Cliente" class="icon-customer" />
            </td>

            <td class="open-modal" data-item='{{ item | tojson | safe }}' data-label="Cliente">
              {{ item.client_name | default('', true) | truncate(10, True) }}
            </td>

            <td class="open-modal" data-item='{{ item | tojson | safe }}' data-label="Criado em">
              {{ item.created_at | format_brasil_data }}
            </td>

            <td class="open-modal" data-item='{{ item | tojson | safe }}' data-label="Telefone">
              {{ item.client_tel | format_telefone }}
            </td>

            <td class="open-modal" data-item='{{ item | tojson | safe }}' data-label="Observa√ß√µes">
              {{ item.client_obs | default('', true) | truncate(15, True) }}
            </td>

            <td data-label="A√ß√µes">
              <div class="d-flex flex-wrap gap-2 justify-content-center align-items-center">
                {% set show_delete_client = True %}
                {% set show_edit_client = True %}
                {% set show_client_transactions = True %}
                {% include 'components/action_buttons.html' with context %}
              </div>
            </td>
          </tr>

          {% endfor %} {% else %}
          <div class="alert alert-warning">Nenhum cliente encontrado.</div>
          {% endif %}
        </tbody>
      </table>


    </div>

    {% else %}

    <p style="color: #308be3; font-weight: bold; font-size: 1.2rem; margin-top: -1rem; margin-left: 0.25rem">Nada por aqui ainda!</p>

    {% endif %}

    <!-- Pagination -->
    {% set route_name = 'listar_clientes' %}


    {% if current_page != 1 or itens_count > 0 %}

    <!-- Pagina√ß√£o -->
    <div class="d-flex justify-content-center mt-4">
      <nav class="text-center">
        <ul class="pagination">
          <!-- Bot√£o voltar -->
          <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{% if current_page > 1 %}?direction=prev{% else %}#{% endif %}">‚Üê</a>
          </li>

          <!-- P√°gina atual -->
          <li class="page-item disabled">
            <span class="page-link">P√°gina {{ current_page }}</span>
          </li>

          <!-- Bot√£o pr√≥ximo -->
          <li class="page-item {% if not next_cursor %}disabled{% endif %}">
            <a class="page-link" href="{% if next_cursor %}?cursor={{ next_cursor }}&direction=next{% else %}#{% endif %}">‚Üí</a>
          </li>
        </ul>
      </nav>
    </div>
    {% endif %}


    {% include 'components/info_modal_client.html' %}
    {% endblock %} {% block scripts %}
    <!-- scripts extras -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <!-- Bootstrap Bundle com Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3xORN3yEh9NTBI69AsVZqg0vszNvB4LaU6gq3p0eNmKUy5OWyE4hzJxKr5oUqvN"
      crossorigin="anonymous"
    ></script>




    <script>
      const nextCursor = '{{ next_cursor }}';
      const urlParams = new URLSearchParams(window.location.search);
      const currentCursor = urlParams.get('cursor');

      const paginacaoUl = document.getElementById('paginacao-numerada');
      paginacaoUl.innerHTML = '';

      // ‚Üê Bot√£o Voltar
      const liPrev = document.createElement('li');
      liPrev.className = 'page-item' + (!currentCursor ? ' disabled' : '');
      const aPrev = document.createElement('a');
      aPrev.className = 'page-link';
      aPrev.href = '#';
      aPrev.innerText = '‚Üê';
      aPrev.onclick = (e) => {
        e.preventDefault();
        const params = new URLSearchParams(window.location.search);
        params.set('direction', 'prev');
        params.delete('cursor'); // Remove o cursor para voltar
        window.location.href = window.location.pathname + '?' + params.toString();
      };
      liPrev.appendChild(aPrev);
      paginacaoUl.appendChild(liPrev);

      // P√°gina atual
      const liPage = document.createElement('li');
      liPage.className = 'page-item disabled';
      const spanPage = document.createElement('span');
      spanPage.className = 'page-link';
      spanPage.textContent = `P√°gina {{ current_page }}`;
      liPage.appendChild(spanPage);
      paginacaoUl.appendChild(liPage);

      // ‚Üí Bot√£o Pr√≥xima
      const liNext = document.createElement('li');
      const aNext = document.createElement('a');
      aNext.className = 'page-link';
      aNext.href = '#';
      aNext.innerText = '‚Üí';
      aNext.onclick = (e) => {
        e.preventDefault();
        const params = new URLSearchParams(window.location.search);
        if (nextCursor && nextCursor !== 'None') {
          params.set('cursor', nextCursor);
          params.set('direction', 'next');
          window.location.href = window.location.pathname + '?' + params.toString();
        }
      };
      liNext.className = 'page-item' + (nextCursor ? '' : ' disabled');
      liNext.appendChild(aNext);
      paginacaoUl.appendChild(liNext);
    </script>








  </div>

  {% endblock %}
</div>
