{% extends "base.html" %}

{% block title %}Agenda{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='style_clientes.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='style_agenda.css') }}" />
{% endblock %}

{% block content %}
{% set status_map = { 'reserved': 'reservado', 'rented': 'retirado', 'returned': 'devolvido', 'overdue': 'atrasado' } %}
<div class="container my-3 agenda-page">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Agenda</h2>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{{ url_for('past_appointments') }}">
        <i class="fas fa-history me-2"></i>Provas Passadas
      </a>
      <a class="btn btn-success" href="{{ url_for('add_fitting') }}">
        <i class="fas fa-plus me-2"></i>Agendar prova
      </a>
    </div>
  </div>

  <section class="mb-4">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-light border-0 py-3" style="display: block !important; visibility: visible !important;">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
          <div class="d-flex align-items-center flex-shrink-0" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
            <i class="fas fa-calendar-day text-info me-2 d-none d-sm-inline" style="display: inline !important; visibility: visible !important; opacity: 1 !important;"></i>
            <h4 class="mb-0 text-dark fw-bold" style="display: block !important; visibility: visible !important; opacity: 1 !important;">Hoje ({{ today_iso|formatar_data_com_dia_semana }})</h4>
          </div>
          <a class="btn btn-outline-success btn-sm flex-shrink-0" href="{{ url_for('add_fitting', date=today_iso) }}" style="display: inline-block !important; visibility: visible !important; opacity: 1 !important;">
            <i class="fas fa-plus me-1" style="display: inline !important; visibility: visible !important; opacity: 1 !important;"></i><span class="d-none d-sm-inline" style="display: inline !important; visibility: visible !important; opacity: 1 !important;">Agendar prova hoje</span><span class="d-sm-none" style="display: none !important;">Agendar</span>
          </a>
        </div>
      </div>
      <div class="card-body p-4">
    
    {% if not rentals_today and not returns_today and not fittings_today %}
    <div class="card shadow-sm border-0 border-start border-4 border-info">
      <div class="card-body text-center py-4">
        <i class="fas fa-calendar-check text-info mb-3" style="font-size: 2rem; opacity: 0.6;"></i>
        <p class="text-muted mb-0">Sem eventos para hoje</p>
        <small class="text-muted">Aproveite para organizar os próximos compromissos!</small>
      </div>
    </div>
    {% endif %}

    {% if returns_today %}
    <div class="mb-3">
      <div class="row g-3">
        {% for tx in returns_today %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card shadow-lg h-100 position-relative rounded-3 border-0 border-start border-4 border-danger">
            <div class="card-body py-3 px-4">
              <!-- Título do card -->
              <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                  <i class="fas fa-undo text-danger me-2"></i>
                  <h6 class="mb-0 fw-bold text-dark">Devolução</h6>
                </div>
                <a href="{{ url_for('all_transactions', transaction_id=tx.transaction_id) }}" class="btn btn-sm btn-outline-danger">
                  <i class="fas fa-eye me-1"></i>Ver transação
                </a>
              </div>
              
              <!-- Campos da transação -->
              <div class="d-flex flex-column gap-2">
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Data</span>
                  <span class="text-end fw-bold">{{ tx.return_date|format_date }}</span>
                </div>

                {% if tx.client_name or tx.client_id %}
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Cliente</span>
                  <span class="text-end">{{ tx.client_name or tx.client_id }}</span>
                </div>
                {% endif %}

                {% if tx.item_description or tx.item_id or tx.item_custom_id %}
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Item</span>
                  <span class="text-end">{{ tx.item_description or tx.item_id or tx.item_custom_id }}</span>
                </div>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center small">
                  <span class="text-muted">Status</span>
                  <div class="text-end">
                    <span class="badge bg-secondary">{{ status_map.get(tx.transaction_status, tx.transaction_status) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
    {% if rentals_today %}
    <div class="mb-3">
      <div class="row g-3">
        {% for tx in rentals_today %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card shadow-lg h-100 position-relative rounded-3 border-0 border-start border-4 border-primary">
            <div class="card-body py-3 px-4">
              <!-- Título do card -->
              <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                  <i class="fas fa-calendar-check text-primary me-2"></i>
                  <h6 class="mb-0 fw-bold text-dark">Retirada</h6>
                </div>
                <a href="{{ url_for('all_transactions', transaction_id=tx.transaction_id) }}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye me-1"></i>Ver transação
                </a>
              </div>
              
              <!-- Campos da transação -->
              <div class="d-flex flex-column gap-2">
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Data</span>
                  <span class="text-end fw-bold">{{ tx.rental_date|format_date }}</span>
                </div>

                {% if tx.client_name or tx.client_id %}
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Cliente</span>
                  <span class="text-end">{{ tx.client_name or tx.client_id }}</span>
                </div>
                {% endif %}

                {% if tx.item_description or tx.item_id or tx.item_custom_id %}
                <div class="d-flex justify-content-between small border-bottom pb-1">
                  <span class="text-muted">Item</span>
                  <span class="text-end">{{ tx.item_description or tx.item_id or tx.item_custom_id }}</span>
                </div>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center small">
                  <span class="text-muted">Status</span>
                  <div class="text-end">
                    <span class="badge bg-secondary">{{ status_map.get(tx.transaction_status, tx.transaction_status) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if fittings_today %}
    <div class="row g-3">
      {% for f in fittings_today %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-lg h-100 position-relative rounded-3 border-0 border-start border-4 border-warning">
          <div class="card-body py-3 px-4">
            <!-- Título do card -->
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-user-tie text-warning me-2"></i>
              <h6 class="mb-0 fw-bold text-dark">Prova</h6>
            </div>
            
            <!-- Botões de ação -->
            <div class="d-flex justify-content-end mb-2 gap-1">
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-outline-secondary dropdown-toggle"
                  type="button"
                  id="dropdownMenuButton{{ loop.index }}"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton{{ loop.index }}">
                  <li>
                    <a class="dropdown-item" href="{{ url_for('edit_fitting', fitting_id=f.fitting_id) }}">
                      <i class="fas fa-edit me-2"></i>Editar
                    </a>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <form method="post" action="{{ url_for('delete_fitting', fitting_id=f.fitting_id) }}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir esta prova?')">
                      <button type="submit" class="dropdown-item text-danger">
                        <i class="fas fa-trash me-2"></i>Excluir
                      </button>
                    </form>
                  </li>
                </ul>
              </div>

              <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalFitting{{ loop.index }}">
                <i class="fas fa-eye"></i>
              </button>
            </div>

            <!-- Campos da prova -->
            <div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Data</span>
                <span class="text-end fw-bold">{{ f.date_local|format_date }}</span>
              </div>
              
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Horário</span>
                <span class="text-end">
                  {% if f.time_local %}
                    <span class="badge bg-info text-dark">{{ f.time_local }}</span>
                  {% else %}
                    <span class="text-muted">Sem horário</span>
                  {% endif %}
                </span>
              </div>

              {% if f.client_name or f.client_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Cliente</span>
                <span class="text-end">
                  {% if f.client_id %}
                    <a href="{{ url_for('clientes') }}?client_id={{ f.client_id }}" class="text-decoration-none">
                      {{ f.client_name or f.client_id }}
                    </a>
                  {% else %}
                    {{ f.client_name }}
                  {% endif %}
                </span>
              </div>
              {% endif %}

              {% if f.item_description or f.item_id or f.item_custom_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Item</span>
                <span class="text-end">
                  {% set item_ref = f.item_id or f.item_custom_id %}
                  {% if item_ref %}
                    <a href="{{ url_for('all_transactions') }}?item_id={{ item_ref }}" class="text-decoration-none">
                      {{ f.item_description or f.item_id or f.item_custom_id }}
                    </a>
                  {% else %}
                    {{ f.item_description }}
                  {% endif %}
                </span>
              </div>
              {% endif %}

              {% if f.notes %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Observações</span>
                <span class="text-end">{{ f.notes | truncate(30, True) }}</span>
              </div>
              {% endif %}

              <div class="d-flex justify-content-between small">
                <span class="text-muted">Status</span>
                <span class="text-end">
                  <span class="badge bg-secondary">{{ f.status }}</span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para detalhes da prova -->
      <div class="modal fade" id="modalFitting{{ loop.index }}" tabindex="-1" aria-labelledby="modalFittingLabel{{ loop.index }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalFittingLabel{{ loop.index }}">Detalhes da Prova</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row g-2">
                <div class="col-6">
                  <strong>Data:</strong><br>
                  <span>{{ f.date_local|format_date }}</span>
                </div>
                <div class="col-6">
                  <strong>Horário:</strong><br>
                  <span>{{ f.time_local or 'Sem horário' }}</span>
                </div>
                <div class="col-6">
                  <strong>ID do Cliente:</strong><br>
                  <span>{{ f.client_id or 'N/A' }}</span>
                </div>
                <div class="col-6">
                  <strong>Nome do Cliente:</strong><br>
                  <span>{{ f.client_name or 'Cliente não definido' }}</span>
                </div>
                <div class="col-6">
                  <strong>ID do Item:</strong><br>
                  <span>{{ f.item_id or f.item_custom_id or 'N/A' }}</span>
                </div>
                <div class="col-6">
                  <strong>Descrição do Item:</strong><br>
                  <span>{{ f.item_description or 'Vestido não definido' }}</span>
                </div>
                <div class="col-12">
                  <strong>Observações:</strong><br>
                  <span>{{ f.notes or 'Nenhuma observação' }}</span>
                </div>
                <div class="col-12">
                  <strong>Status:</strong><br>
                  <span class="badge bg-secondary">{{ f.status }}</span>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <a href="{{ url_for('edit_fitting', fitting_id=f.fitting_id) }}" class="btn btn-primary">Editar</a>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
      </div>
    </div>
  </section>

  <!-- Divisória entre "Hoje" e próximas datas -->
  {% if next_days %}
  <div class="row my-5">
    <div class="col-12">
      <div class="d-flex align-items-center">
        <div class="flex-grow-1">
          <hr class="border-2 border-success opacity-25">
        </div>
        <div class="px-4">
          <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
            <i class="fas fa-clock me-2"></i>Próximos eventos
          </span>
        </div>
        <div class="flex-grow-1">
          <hr class="border-2 border-success opacity-25">
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {% for day in next_days %}
  {% set outer_loop = loop %}
  
  <!-- Divisória entre datas (não mostrar antes da primeira data) -->
  {% if not loop.first %}
  <div class="row my-5">
    <div class="col-12">
      <div class="d-flex align-items-center">
        <div class="flex-grow-1">
          <hr class="border-2 border-primary opacity-25">
        </div>
        <div class="px-3">
          <i class="fas fa-calendar-alt text-primary opacity-50"></i>
        </div>
        <div class="flex-grow-1">
          <hr class="border-2 border-primary opacity-25">
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  
  <section class="mb-5">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-light border-0 py-3" style="display: block !important; visibility: visible !important;">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
          <div class="d-flex align-items-center flex-shrink-0" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
            <i class="fas fa-calendar-day text-info me-2 d-none d-sm-inline" style="display: inline !important; visibility: visible !important; opacity: 1 !important;"></i>
            <h4 class="mb-0 text-dark fw-bold" style="display: block !important; visibility: visible !important; opacity: 1 !important;">{{ day.date_iso|formatar_data_com_dia_semana }}</h4>
          </div>
          <a class="btn btn-outline-success btn-sm flex-shrink-0" href="{{ url_for('add_fitting', date=day.date_iso) }}" style="display: inline-block !important; visibility: visible !important; opacity: 1 !important;">
            <i class="fas fa-plus me-1" style="display: inline !important; visibility: visible !important; opacity: 1 !important;"></i><span class="d-none d-sm-inline" style="display: inline !important; visibility: visible !important; opacity: 1 !important;">Agendar prova</span><span class="d-sm-none" style="display: none !important;">Agendar</span>
          </a>
        </div>
      </div>
      <div class="card-body p-4">
    {% if day['fitting_items'] %}
    <div class="row g-3">
      {% for f in day['fitting_items'] %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-lg h-100 position-relative rounded-3 border-0 border-start border-4 border-info">
          <div class="card-body py-3 px-4">
            <!-- Título do card -->
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-user-tie text-info me-2"></i>
              <h6 class="mb-0 fw-bold text-dark">Prova</h6>
            </div>
            
            <!-- Botões de ação -->
            <div class="d-flex justify-content-end mb-2 gap-1">
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-outline-secondary dropdown-toggle"
                  type="button"
                  id="dropdownMenuButton{{ loop.index }}"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton{{ loop.index }}">
                  <li>
                    <a class="dropdown-item" href="{{ url_for('edit_fitting', fitting_id=f.fitting_id) }}">
                      <i class="fas fa-edit me-2"></i>Editar
                    </a>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <form method="post" action="{{ url_for('delete_fitting', fitting_id=f.fitting_id) }}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir esta prova?')">
                      <button type="submit" class="dropdown-item text-danger">
                        <i class="fas fa-trash me-2"></i>Excluir
                      </button>
                    </form>
                  </li>
                </ul>
              </div>

              <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalFittingDay{{ outer_loop.index0 }}_{{ loop.index }}">
                <i class="fas fa-eye"></i>
              </button>
            </div>

            <!-- Campos da prova -->
            <div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Data</span>
                <span class="text-end fw-bold">{{ f.date_local|format_date }}</span>
              </div>
              
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Horário</span>
                <span class="text-end">
                  {% if f.time_local %}
                    <span class="badge bg-info text-dark">{{ f.time_local }}</span>
                  {% else %}
                    <span class="text-muted">Sem horário</span>
                  {% endif %}
                </span>
              </div>

              {% if f.client_name or f.client_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Cliente</span>
                <span class="text-end">
                  {% if f.client_id %}
                    <a href="{{ url_for('clientes') }}?client_id={{ f.client_id }}" class="text-decoration-none">
                      {{ f.client_name or f.client_id }}
                    </a>
                  {% else %}
                    {{ f.client_name }}
                  {% endif %}
                </span>
              </div>
              {% endif %}

              {% if f.item_description or f.item_id or f.item_custom_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Item</span>
                <span class="text-end">
                  {% set item_ref = f.item_id or f.item_custom_id %}
                  {% if item_ref %}
                    <a href="{{ url_for('all_transactions') }}?item_id={{ item_ref }}" class="text-decoration-none">
                      {{ f.item_description or f.item_id or f.item_custom_id }}
                    </a>
                  {% else %}
                    {{ f.item_description }}
                  {% endif %}
                </span>
              </div>
              {% endif %}

              {% if f.notes %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Observações</span>
                <span class="text-end">{{ f.notes | truncate(30, True) }}</span>
              </div>
              {% endif %}

              <div class="d-flex justify-content-between small">
                <span class="text-muted">Status</span>
                <span class="text-end">
                  <span class="badge bg-secondary">{{ f.status }}</span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para detalhes da prova -->
      <div class="modal fade" id="modalFittingDay{{ outer_loop.index0 }}_{{ loop.index }}" tabindex="-1" aria-labelledby="modalFittingDayLabel{{ outer_loop.index0 }}_{{ loop.index }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalFittingDayLabel{{ outer_loop.index0 }}_{{ loop.index }}">Detalhes da Prova</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row g-2">
                <div class="col-6">
                  <strong>Data:</strong><br>
                  <span>{{ f.date_local|format_date }}</span>
                </div>
                <div class="col-6">
                  <strong>Horário:</strong><br>
                  <span>{{ f.time_local or 'Sem horário' }}</span>
                </div>
                <div class="col-6">
                  <strong>ID do Cliente:</strong><br>
                  <span>{{ f.client_id or 'N/A' }}</span>
                </div>
                <div class="col-6">
                  <strong>Nome do Cliente:</strong><br>
                  <span>{{ f.client_name or 'Cliente não definido' }}</span>
                </div>
                <div class="col-6">
                  <strong>ID do Item:</strong><br>
                  <span>{{ f.item_id or f.item_custom_id or 'N/A' }}</span>
                </div>
                <div class="col-6">
                  <strong>Descrição do Item:</strong><br>
                  <span>{{ f.item_description or 'Vestido não definido' }}</span>
                </div>
                <div class="col-12">
                  <strong>Observações:</strong><br>
                  <span>{{ f.notes or 'Nenhuma observação' }}</span>
                </div>
                <div class="col-12">
                  <strong>Status:</strong><br>
                  <span class="badge bg-secondary">{{ f.status }}</span>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <a href="{{ url_for('edit_fitting', fitting_id=f.fitting_id) }}" class="btn btn-primary">Editar</a>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
   {% endif %}

    <!-- Transações para esta data -->
    {% if day['transaction_items'] %}
    <div class="row g-3 {% if day['fitting_items'] %}mt-3{% endif %}">
      {% for tx in day['transaction_items'] %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-lg h-100 position-relative rounded-3 border-0 border-start border-4 {% if tx.transaction_type == 'pickup' %}border-success{% else %}border-danger{% endif %}">
          <div class="card-body py-3 px-4">
            <!-- Título do card -->
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center">
                {% if tx.transaction_type == 'pickup' %}
                  <i class="fas fa-calendar-check text-success me-2"></i>
                  <h6 class="mb-0 fw-bold text-dark">Retirada</h6>
                {% else %}
                  <i class="fas fa-undo text-danger me-2"></i>
                  <h6 class="mb-0 fw-bold text-dark">Devolução</h6>
                {% endif %}
              </div>
              <a href="{{ url_for('all_transactions', transaction_id=tx.transaction_id) }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-eye me-1"></i>Ver transação
              </a>
            </div>
            
            <!-- Campos da transação -->
            <div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Data</span>
                <span class="text-end fw-bold">
                  {% if tx.transaction_type == 'pickup' %}
                    {{ tx.rental_date|format_date }}
                  {% else %}
                    {{ tx.return_date|format_date }}
                  {% endif %}
                </span>
              </div>

              {% if tx.client_name or tx.client_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Cliente</span>
                <span class="text-end">
                  {{ tx.client_name or tx.client_id }}
                </span>
              </div>
              {% endif %}

              {% if tx.item_description or tx.item_id or tx.item_custom_id %}
              <div class="d-flex justify-content-between small border-bottom pb-1">
                <span class="text-muted">Item</span>
                <span class="text-end">
                  {{ tx.item_description or tx.item_id or tx.item_custom_id }}
                </span>
              </div>
              {% endif %}

              <div class="d-flex justify-content-between align-items-center small">
                <span class="text-muted">Status</span>
                <div class="text-end">
                  <span class="badge bg-secondary">{{ status_map.get(tx.transaction_status, tx.transaction_status) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if not day['fitting_items'] and not day['transaction_items'] %}
    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i>Sem eventos para esta data.
    </div>
    {% endif %}
      </div>
    </div>
  </section>
  {% endfor %}

  {% if not rentals_today and not returns_today and not fittings_today and not next_days %}
  <div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>Nenhum evento encontrado. Use "Agendar prova" para criar o primeiro.
  </div>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}
<!-- FontAwesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- Bootstrap Bundle -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-A3xORN3yEh9NTBI69AsVZqg0vszNvB4LaU6gq3p0eNmKUy5OWyE4hzJxKr5oUqvN"
  crossorigin="anonymous"
></script>
{% endblock %}