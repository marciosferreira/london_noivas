<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Completo - London Noivas</title>
    <!-- Same head content as index.html -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'london-gold': '#C5A059',
                        'stone': {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            800: '#292524',
                            900: '#1c1917',
                        }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        .animate-fadeIn { animation: fadeIn 1.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans antialiased">

    <!-- Header (Simplified) -->
    <header class="bg-stone-900 py-6 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="/" class="flex items-center gap-2 group">
                <div class="w-10 h-10 bg-london-gold flex items-center justify-center rounded-sm group-hover:bg-white transition-colors">
                    <span class="text-white font-serif text-xl font-bold group-hover:text-london-gold">L</span>
                </div>
                <h1 class="text-xl font-serif tracking-widest text-white group-hover:text-london-gold transition-colors">
                    LONDON NOIVAS
                </h1>
            </a>
            <a href="/" class="text-stone-300 hover:text-white text-sm tracking-widest uppercase font-bold transition-colors">
                &larr; Voltar ao Início
            </a>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div class="text-center mb-16">
            <h2 class="text-4xl md:text-5xl font-serif text-stone-800 mb-4">Catálogo Exclusivo</h2>
            <div class="w-24 h-1 bg-london-gold mx-auto mb-6"></div>
            <p class="text-stone-500 max-w-xl mx-auto mb-8">
                Explore nossa coleção completa de vestidos de noiva e festa.
            </p>
            
            <!-- AI Search Bar -->
            <div class="max-w-2xl mx-auto relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-london-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input 
                    type="text" 
                    id="ai-catalog-search-input"
                    class="w-full pl-12 pr-4 py-4 bg-white border-2 border-stone-200 rounded-full focus:outline-none focus:border-london-gold focus:ring-1 focus:ring-london-gold transition-all shadow-sm text-stone-700 placeholder-stone-400"
                    placeholder="ex: vestido sereia com renda e manga longa"
                    onkeypress="handleEnterSearch(event)"
                >
                <button 
                    onclick="performCatalogSearch(1)"
                    class="absolute right-2 top-2 bottom-2 bg-london-gold text-white px-6 rounded-full hover:bg-stone-800 transition-colors font-medium tracking-wide shadow-md"
                >
                    BUSCAR
                </button>
            </div>
            <p class="text-xs text-stone-400 mt-2 italic">Powered by London AI &trade;</p>
        </div>

        <!-- Loading State -->
        <div id="search-loading" class="hidden text-center py-12">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-london-gold border-t-transparent"></div>
            <p class="mt-4 text-stone-500 font-serif animate-pulse">Consultando nossa estilista virtual...</p>
        </div>

        <!-- Catalog Grid -->
        <div id="catalog-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8">
            {% if itens %}
                {% for item in itens %}
                <div class="group bg-white rounded-sm shadow-sm hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden animate-fadeIn"
                     onclick="openCatalogModalById('{{ item.item_id }}', 'catalog')">
                    
                    <div class="aspect-[3/4] overflow-hidden bg-stone-200 relative">
                        <img src="{{ item.item_image_url }}" alt="{{ item.title }}" class="w-full h-full object-contain group-hover:scale-105 transition-transform duration-700">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                        <div class="absolute bottom-4 right-4 bg-white/90 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-stone-800">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <h3 class="font-serif text-lg text-stone-800 mb-2 truncate">{{ item.title }}</h3>
                        <p class="text-xs text-london-gold tracking-widest font-bold uppercase">Ver Detalhes</p>
                    </div>
                </div>
                <script>
                    window.catalogData = window.catalogData || {};
                    window.catalogData['{{ item.item_id }}'] = {
                        imageUrl: '{{ item.item_image_url }}',
                        title: '{{ item.title | replace("'", "\\'") }}',
                        description: '{{ item.item_description | replace("'", "\\'") | replace("\n", " ") }}',
                        price: '{{ item.item_value }}',
                        customId: '{{ item.item_custom_id }}'
                    };
                </script>
                {% endfor %}
            {% else %}
                <div class="col-span-full text-center py-20 bg-stone-100 rounded-lg">
                    <p class="text-stone-500 text-xl font-serif">Digite o que procura acima para ver nossa coleção.</p>
                </div>
            {% endif %}
        </div>

        <!-- Pagination Controls -->
        <div id="catalog-pagination" class="{% if total_pages and total_pages > 1 %}flex{% else %}hidden{% endif %} justify-center items-center mt-12 gap-4">
            {% if page and page > 1 %}
            <a href="{{ url_for('catalogo', page=page-1) }}" class="px-6 py-3 border border-stone-300 text-stone-600 hover:bg-stone-800 hover:text-white hover:border-stone-800 transition-all font-medium rounded-sm">
                &larr; Anterior
            </a>
            {% endif %}
            
            <span class="font-serif text-stone-500 mx-4">
                Página <span class="text-stone-800 font-bold">{{ page|default(1) }}</span> de {{ total_pages|default(1) }}
            </span>
            
            {% if page and total_pages and page < total_pages %}
            <a href="{{ url_for('catalogo', page=page+1) }}" class="px-6 py-3 border border-stone-300 text-stone-600 hover:bg-stone-800 hover:text-white hover:border-stone-800 transition-all font-medium rounded-sm">
                Próxima &rarr;
            </a>
            {% endif %}
        </div>

    </main>

    <!-- Catalog Modal -->
    <div id="catalog-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-stone-900/95 backdrop-blur-sm" onclick="closeCatalogModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 md:p-8 pointer-events-none">
            <div class="bg-white w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col md:flex-row pointer-events-auto rounded-sm relative">
                
                <button onclick="closeCatalogModal()" class="absolute top-4 right-4 z-10 text-stone-400 hover:text-stone-800 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <!-- Image Side -->
                <div class="md:w-1/2 bg-stone-100 relative h-[40vh] md:h-auto group cursor-zoom-in" onclick="openFullImage(document.getElementById('modal-img').src)">
                    <img id="modal-img" src="" alt="Detail" class="w-full h-full object-contain transition-transform duration-500 hover:scale-105">
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-12 h-12 drop-shadow-lg">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                        </svg>
                    </div>
                </div>
                
                <!-- Content Side -->
                <div class="md:w-1/2 p-8 md:p-12 flex flex-col overflow-y-auto bg-white">
                    <div class="flex-1">
                        <span class="text-london-gold font-bold tracking-widest text-xs uppercase mb-2 block">London Noivas Collection</span>
                        <h3 id="modal-title" class="text-3xl md:text-4xl font-serif text-stone-900 mb-2 leading-tight"></h3>
                        <p id="modal-price" class="text-2xl text-stone-600 font-serif mb-2"></p>
                        <p class="text-xs text-stone-400 mb-6 font-mono">ID: <span id="modal-id-value"></span></p>
                        
                        <div class="w-12 h-1 bg-stone-200 mb-8"></div>
                        
                        <div class="prose prose-stone max-w-none">
                            <h4 class="font-serif text-lg text-stone-800 mb-2">Descrição da Peça</h4>
                            <p id="modal-desc" class="text-stone-600 font-light leading-relaxed text-lg mb-8"></p>
                        </div>

                        <!-- Similar Items Section -->
                        <div id="modal-similar-section" class="hidden mb-8">
                            <div class="w-12 h-1 bg-stone-200 mb-6"></div>
                            <h4 class="font-serif text-lg text-stone-800 mb-4">Você também pode gostar</h4>
                            <div id="modal-similar-grid" class="grid grid-cols-2 gap-4">
                                <!-- Similar items injected here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-8 border-t border-stone-100">
                        <p class="text-stone-400 text-sm mb-4 text-center italic">Gostou deste modelo? Fale conosco agora.</p>
                        <a id="modal-whatsapp-link" href="#" target="_blank" class="block w-full bg-[#25D366] hover:bg-[#1ebc57] text-white py-4 px-6 rounded-sm transition-colors text-center shadow-lg hover:shadow-xl transform hover:-translate-y-1 duration-200 flex items-center justify-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
                            </svg>
                            <span class="font-bold tracking-widest text-sm">SOLICITAR MAIS INFORMAÇÕES</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global catalog data store
        window.catalogData = window.catalogData || {};

        function openCatalogModalById(itemId, source) {
            const data = window.catalogData && window.catalogData[itemId];
            if (data) {
                openCatalogModal(data.imageUrl, data.title, data.description, itemId, data.price, source, data.customId);
            } else {
                console.error('Dados do item não encontrados para ID:', itemId);
            }
        }

        function openCatalogModal(imageUrl, title, description, itemId, price, source, customDisplayId) {
            const idToShow = customDisplayId || itemId;
            
            // Handle Price Display Logic
            let displayPrice = price;
            if (!price || price === '0' || price === 0 || price === '0.00' || price === '0,00') {
                displayPrice = 'Consulte o preço do aluguel';
            }

            document.getElementById('modal-img').src = imageUrl || 'https://via.placeholder.com/600x800?text=Sem+Imagem';
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-desc').textContent = description;
            document.getElementById('modal-price').textContent = displayPrice;
            document.getElementById('modal-id-value').textContent = idToShow;
            
            const phoneNumber = "5592993531943";
            
            // Construct message with Title and ID
            let text = `Olá, gostaria de mais informações sobre o vestido do catálogo: ${title}`;
            text += `\nCód: ${idToShow}`;
            
            const isAiItem = itemId && itemId.toString().startsWith('ai_');
            
            // Always include Image URL
            const fullImageUrl = new URL(imageUrl, window.location.origin).href;
            text += `\nImagem: ${fullImageUrl}`;

            if (!isAiItem) {
                const url = new URL(window.location);
                url.searchParams.set('item', itemId);
                window.history.pushState({}, '', url);
                text += `\nLink: ${url.toString()}`;
            }

            const encodedText = encodeURIComponent(text);
            const whatsappLink = document.getElementById('modal-whatsapp-link');
            whatsappLink.href = `https://wa.me/${phoneNumber}?text=${encodedText}`;
            
            if (isAiItem) {
                whatsappLink.onclick = function() { trackWhatsAppClick('ai_modal_whatsapp'); };
            } else {
                whatsappLink.onclick = function() { trackWhatsAppClick('catalog_modal_whatsapp'); };
            }
            
            document.getElementById('catalog-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            const similarSection = document.getElementById('modal-similar-section');
            const similarGrid = document.getElementById('modal-similar-grid');
            similarSection.classList.add('hidden');
            similarGrid.innerHTML = '';

            if (itemId && !isAiItem) {
                // Increment visit count for all sources
                fetch(`/api/item/${itemId}/visit`, { method: 'POST' })
                    .catch(err => console.error('Error incrementing visit count:', err));

                fetch(`/api/ai-similar/${itemId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.suggestions && data.suggestions.length > 0) {
                            data.suggestions.forEach(item => {
                                const div = document.createElement('div');
                                div.className = 'cursor-pointer group';
                                div.onclick = () => openCatalogModal(item.image_url, item.title, item.description, item.id, 'Consulte o preço do aluguel', 'similar', item.customId);
                                div.innerHTML = `
                                    <div class="aspect-[3/4] bg-stone-100 overflow-hidden mb-2 rounded-sm relative">
                                        <img src="${item.image_url}" class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-110" alt="${item.title}">
                                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div>
                                    </div>
                                    <p class="text-xs font-bold text-stone-800 uppercase tracking-wide truncate">${item.title}</p>
                                `;
                                similarGrid.appendChild(div);
                            });
                            similarSection.classList.remove('hidden');
                        }
                    })
                    .catch(err => console.error('Erro ao buscar similares:', err));
            }
        }

        function closeCatalogModal() {
            document.getElementById('catalog-modal').classList.add('hidden');
            document.body.style.overflow = '';
            
            const url = new URL(window.location);
            url.searchParams.delete('item');
            window.history.pushState({}, '', url);
        }

        // AI Search Logic
        let currentSearchQuery = '';

        function handleEnterSearch(event) {
            if (event.key === 'Enter') {
                performCatalogSearch(1);
            }
        }

        function performCatalogSearch(page = 1) {
            const input = document.getElementById('ai-catalog-search-input');
            const loading = document.getElementById('search-loading');
            
            if (page === 1) {
                currentSearchQuery = input.value.trim();
            }

            if (!currentSearchQuery) return;

            loading.classList.remove('hidden');
            
            trackEvent('ai_catalog_search', {
                'search_term': currentSearchQuery,
                'page': page
            });

            fetch('/api/ai-catalog-search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: currentSearchQuery, page: page, limit: 12 })
            })
            .then(response => response.json())
            .then(data => {
                loading.classList.add('hidden');
                if (data.results) {
                    updateCatalogGrid(data);
                    const gridElement = document.getElementById('catalog-grid');
                    if (gridElement) {
                        const headerOffset = 150;
                        const elementPosition = gridElement.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });
                    }
                } else if (data.error) {
                    console.error('Search error:', data.error);
                    alert('Erro na busca. Tente novamente.');
                }
            })
            .catch(err => {
                loading.classList.add('hidden');
                console.error('Fetch error:', err);
                alert('Erro de conexão.');
            });
        }

        function updateCatalogGrid(data) {
            const items = data.results || [];
            const currentPage = data.page || 1;
            const totalPages = data.total_pages || 1;
            
            const grid = document.getElementById('catalog-grid');
            const pagination = document.getElementById('catalog-pagination');
            
            grid.innerHTML = '';
            if (pagination) {
                pagination.innerHTML = '';
                pagination.classList.add('hidden');
            }

            if (items.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20 bg-stone-100 rounded-lg">
                        <p class="text-stone-500 text-xl font-serif">Nenhum vestido encontrado para sua descrição.</p>
                        <button onclick="window.location.reload()" class="mt-4 text-london-gold hover:underline">Ver todos os vestidos</button>
                    </div>
                `;
                return;
            }

            items.forEach(item => {
                window.catalogData = window.catalogData || {};
                window.catalogData[item.item_id] = {
                    imageUrl: item.imageUrl,
                    title: item.title,
                    description: item.description,
                    price: item.price,
                    customId: item.customId || item.item_id
                };

                const div = document.createElement('div');
                div.className = 'group bg-white rounded-sm shadow-sm hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden animate-fadeIn';
                div.onclick = () => openCatalogModal(item.imageUrl, item.title, item.description, item.item_id, item.price, 'ai_search', item.customId);
                
                div.innerHTML = `
                    <div class="aspect-[3/4] overflow-hidden bg-stone-200 relative">
                        <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-full object-contain group-hover:scale-105 transition-transform duration-700">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                        <div class="absolute bottom-4 right-4 bg-white/90 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-stone-800">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <h3 class="font-serif text-lg text-stone-800 mb-2 truncate">${item.title}</h3>
                        <p class="text-xs text-london-gold tracking-widest font-bold uppercase">Ver Detalhes</p>
                    </div>
                `;
                
                grid.appendChild(div);
            });

            if (pagination && totalPages > 1) {
                pagination.classList.remove('hidden');
                let paginationHtml = '';
                
                if (currentPage > 1) {
                    paginationHtml += `
                        <button onclick="performCatalogSearch(${currentPage - 1})" class="px-6 py-3 border border-stone-300 text-stone-600 hover:bg-stone-800 hover:text-white hover:border-stone-800 transition-all font-medium rounded-sm">
                            &larr; Anterior
                        </button>
                    `;
                }
                
                paginationHtml += `
                    <span class="font-serif text-stone-500 mx-4">
                        Página <span class="text-stone-800 font-bold">${currentPage}</span> de ${totalPages}
                    </span>
                `;
                
                if (currentPage < totalPages) {
                    paginationHtml += `
                        <button onclick="performCatalogSearch(${currentPage + 1})" class="px-6 py-3 border border-stone-300 text-stone-600 hover:bg-stone-800 hover:text-white hover:border-stone-800 transition-all font-medium rounded-sm">
                            Próxima &rarr;
                        </button>
                    `;
                }
                
                pagination.innerHTML = paginationHtml;
            }
        }

        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const itemId = urlParams.get('item');
            if (itemId && window.catalogData && window.catalogData[itemId]) {
                const item = window.catalogData[itemId];
                openCatalogModal(item.imageUrl, item.title, item.description, itemId, item.price, 'direct', item.customId);
            }
        });
    </script>

    <!-- Analytics Tracking Scripts -->
    <script>
        const GA_MEASUREMENT_ID = 'G-23RSZ1SMRX';

        function trackEvent(eventName, params) {
            console.log('Event Tracked:', eventName, params);
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, params);
            }
        }

        function trackWhatsAppClick(location) {
            trackEvent('whatsapp_click', {
                'event_category': 'contact',
                'event_label': location,
                'transport_type': 'beacon'
            });
        }
    </script>
    <!-- Full Screen Image Modal -->
    <div id="full-image-modal" class="fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="closeFullImage()"></div>
        
        <button onclick="closeFullImage()" class="absolute top-4 right-4 z-[210] text-white/70 hover:text-white transition-colors p-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <img id="full-image-img" src="" alt="Full Screen" class="max-w-full max-h-full object-contain shadow-2xl pointer-events-auto rounded-sm">
        </div>
    </div>

    <script>
        function openFullImage(src) {
            if (!src || src.includes('placeholder')) return;
            const modal = document.getElementById('full-image-modal');
            const img = document.getElementById('full-image-img');
            img.src = src;
            modal.classList.remove('hidden');
            // document.body.style.overflow = 'hidden'; // Already hidden by catalog modal
        }

        function closeFullImage() {
            const modal = document.getElementById('full-image-modal');
            modal.classList.add('hidden');
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const fullModal = document.getElementById('full-image-modal');
                if (!fullModal.classList.contains('hidden')) {
                    closeFullImage();
                    // Prevent event propagation so catalog modal doesn't close too if it listens to Esc
                    event.stopPropagation();
                }
            }
        });
    </script>
    <!-- Full Screen Image Modal -->
    <div id="full-image-modal" class="fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="closeFullImage()"></div>
        
        <button onclick="closeFullImage()" class="absolute top-4 right-4 z-[210] text-white/70 hover:text-white transition-colors p-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <img id="full-image-img" src="" alt="Full Screen" class="max-w-full max-h-full object-contain shadow-2xl pointer-events-auto rounded-sm">
        </div>
    </div>

    <script>
        function openFullImage(src) {
            if (!src || src.includes('placeholder')) return;
            const modal = document.getElementById('full-image-modal');
            const img = document.getElementById('full-image-img');
            img.src = src;
            modal.classList.remove('hidden');
        }

        function closeFullImage() {
            const modal = document.getElementById('full-image-modal');
            modal.classList.add('hidden');
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const fullModal = document.getElementById('full-image-modal');
                if (!fullModal.classList.contains('hidden')) {
                    closeFullImage();
                    event.stopPropagation();
                }
            }
        });
    </script>
</body>
</html>