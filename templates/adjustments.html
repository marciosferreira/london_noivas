{% extends "base.html" %}

{% block title %}Ajustes{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='style_adjustments.css') }}" />
{% endblock %}

{% block content %}
<div class="adjustments-page">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-4">
      <div>
        <h2 class="mb-1">Ajustes</h2>
        <div class="text-muted">Gerencie informações da conta e preferências.</div>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <strong>Nome da Loja</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('change_username') }}">
              <div class="mb-3">
                <label class="form-label mb-1"><strong>Nome atual</strong></label>
                <input type="text" class="form-control" value="{{ username }}" disabled />
              </div>
              <div class="mb-3">
                <label for="new_username" class="form-label mb-1">Novo nome</label>
                <input type="text" id="new_username" name="new_username" class="form-control" required minlength="3" maxlength="15" />
              </div>
              <button type="submit" class="btn btn-primary w-100">Atualizar</button>
            </form>
          </div>
        </div>
      </div>

      {% if can_manage_colors %}
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100" id="colors">
          <div class="card-header bg-white">
            <strong>Cores</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('add_color_option') }}">
              <div class="row g-2">
                <div class="col-12 col-md-5">
                  <select class="form-select" name="color_base" required>
                    <option value="">Cor base</option>
                    {% for b in base_color_options %}
                      <option value="{{ b }}">{{ b }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-12 col-md-5">
                  <input type="text" class="form-control" name="color_name" placeholder="Nome comercial (ex: Terracota)" required />
                </div>
                <div class="col-12 col-md-2 d-grid">
                  <button class="btn btn-outline-primary" type="submit">Adicionar</button>
                </div>
              </div>
            </form>

            <div class="mt-3">
              {% if color_options %}
                <ul class="list-group">
                  {% for c in color_options %}
                    <li class="list-group-item d-flex align-items-center py-2">
                      <div class="d-flex align-items-center gap-2 flex-nowrap w-100">
                        <form method="POST" action="{{ url_for('edit_color_option') }}" class="m-0 d-flex align-items-center gap-2 flex-nowrap flex-grow-1">
                          <input type="hidden" name="old_color_base" value="{{ c.base }}">
                          <input type="hidden" name="old_color_name" value="{{ c.name }}">
                          <select class="form-select form-select-sm" name="new_color_base" required>
                            {% for b in base_color_options %}
                              <option value="{{ b }}" {% if b == c.base %}selected{% endif %}>{{ b }}</option>
                            {% endfor %}
                          </select>
                          <input type="text" class="form-control form-control-sm flex-grow-1" name="new_color_name" value="{{ c.name }}" required />
                          <button type="submit" class="btn btn-sm btn-outline-primary">Salvar</button>
                        </form>
                        <form method="POST" action="{{ url_for('delete_color_option') }}" class="m-0 flex-shrink-0">
                          <input type="hidden" name="color_base" value="{{ c.base }}">
                          <input type="hidden" name="color_name" value="{{ c.name }}">
                          <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
                        </form>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted mb-0">Nenhuma cor cadastrada.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if can_manage_sizes %}
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100" id="sizes">
          <div class="card-header bg-white">
            <strong>Tamanhos</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('add_size_option') }}">
              <div class="input-group">
                <input type="text" class="form-control" name="size" placeholder="Ex: PP ou 38" />
                <button class="btn btn-outline-primary" type="submit">Adicionar</button>
              </div>
            </form>

            <div class="mt-3">
              {% if size_options %}
                <ul class="list-group">
                  {% for s in size_options %}
                    <li class="list-group-item d-flex align-items-center py-2">
                      <div class="d-flex align-items-center gap-2 flex-nowrap w-100">
                        <form method="POST" action="{{ url_for('edit_size_option') }}" class="m-0 d-flex align-items-center gap-2 flex-nowrap flex-grow-1">
                          <input type="hidden" name="old_size" value="{{ s }}">
                          <input type="text" class="form-control form-control-sm flex-grow-1" name="new_size" value="{{ s }}" />
                          <button type="submit" class="btn btn-sm btn-outline-primary">Salvar</button>
                        </form>
                        <form method="POST" action="{{ url_for('delete_size_option') }}" class="m-0 flex-shrink-0">
                          <input type="hidden" name="size" value="{{ s }}">
                          <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
                        </form>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted mb-0">Nenhum tamanho cadastrado.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <strong>Alterar Senha</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('change_password') }}">
              <div class="mb-3">
                <label for="current_password" class="form-label mb-1">Senha Atual</label>
                <input type="password" id="current_password" name="current_password" class="form-control" required />
              </div>
              <div class="mb-3">
                <label for="new_password" class="form-label mb-1">Nova Senha</label>
                <input type="password" id="new_password" name="new_password" class="form-control" required minlength="8" />
              </div>
              <div class="mb-3">
                <label for="confirm_new_password" class="form-label mb-1">Confirme a Nova Senha</label>
                <input type="password" id="confirm_new_password" name="confirm_new_password" class="form-control" required />
              </div>
              <button type="submit" class="btn btn-primary w-100">Alterar</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <strong>Alterar E-mail</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('request_email_change') }}">
              <div class="mb-3">
                <label class="form-label mb-1"><strong>E-mail atual</strong></label>
                <input type="email" class="form-control" value="{{ email }}" disabled />
              </div>
              <div class="mb-3">
                <label for="new_email" class="form-label mb-1">Novo e-mail</label>
                <input type="email" id="new_email" name="new_email" class="form-control" required />
              </div>
              <button type="submit" class="btn btn-primary w-100">Atualizar</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white">
            <strong>Fuso Horário</strong>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('change_timezone') }}">
              <div class="mb-3">
                <label for="timezone" class="form-label mb-1">Fuso horário</label>
                <select id="timezone" name="timezone" class="form-select" required>
                  {% for tz in timezones %}
                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz }}</option>
                  {% endfor %}
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-100">Atualizar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% endblock %}
