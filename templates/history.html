<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Histórico de Aluguéis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <!-- CSS específico para a página -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style_history.css') }}" />
  </head>

  <body class="history">

    <!-- Importa o Header (agora no local correto) -->
    {% include 'header.html' %}

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container my-4">
      {% block content %}
        {% include "common_section.html" with context %}
      {% endblock %}

      <!-- Seção de filtros -->
      <div id="filter-section" class="d-none">
        <div class="p-3">
          <form method="GET" action="/history">
            <div class="row g-3">
              <!-- Descrição -->
              <div class="col-auto">
                <label for="description" class="form-label">Descrição:</label>
                <input type="text" class="form-control" id="description" name="description" value="{{ request.args.get('description', '') }}" />
              </div>

              <!-- Nome do cliente -->
              <div class="col-auto">
                <label for="client-name" class="form-label">Nome do Cliente:</label>
                <input type="text" class="form-control" id="client-name" name="client_name" value="{{ request.args.get('client_name', '') }}" />
              </div>

              <!-- Pagamento -->
              <div class="col-auto">
                <label for="payment-status" class="form-label">Pagamento:</label>
                <select class="form-select" id="payment-status" name="payment">
                  <option value="">Todos</option>
                  <option value="Não pago" {% if request.args.get('payment') == 'Não pago' %}selected{% endif %}>Não Pago</option>
                  <option value="Pago 50%" {% if request.args.get('payment') == 'Pago 50%' %}selected{% endif %}>Pago 50%</option>
                  <option value="Pago 100%" {% if request.args.get('payment') == 'Pago 100%' %}selected{% endif %}>Pago 100%</option>
                </select>
              </div>

              <!-- Data de retirada -->
              <div class="col-auto">
                <label for="start-date" class="form-label">Retirada prevista (de):</label>
                <input type="date" class="form-control" id="start-date" name="start_date" value="{{ request.args.get('start_date', '') }}" />
              </div>

              <div class="col-auto">
                <label for="end-date" class="form-label">Retirada prevista (até):</label>
                <input type="date" class="form-control" id="end-date" name="end_date" value="{{ request.args.get('end_date', '') }}" />
              </div>
            </div>

            <div class="mt-3">
              <button type="submit" class="btn btn-primary">Aplicar Filtros</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Tabela de Histórico -->
      <div class="table-container mt-4">
        <table class="table table-hover responsive-table align-middle rounded-table">
          <thead>
            <tr>
              <th>Imagem</th>
              <th>Descrição</th>
              <th>Cliente</th>
              <th>Telefone</th>
              <th>Retirada Prevista</th>
              <th>Devolução Prevista</th>
              <th>Valor (R$)</th>
              <th>Pagamento</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
            <tr>
              <td>
                {% if item.image_url and item.image_url != "" %}
                  <img src="{{ item.image_url }}" alt="Imagem do item" class="img-fluid item-thumbnail" style="max-width: 100px;" />
                {% else %}
                  <img src="{{ url_for('static', filename='item-placeholder.png') }}" alt="Sem Imagem" class="img-fluid item-thumbnail" style="max-width: 100px;" />
                {% endif %}
              </td>
              <td>{{ item.description }}</td>
              <td>{{ item.client_name }}</td>
              <td>{{ item.client_tel }}</td>
              <td>{{ item.rental_date_formatted }}</td>
              <td>{{ item.return_date_formatted }}</td>
              <td>{{ item.valor }}</td>
              <td>{{ item.pagamento }}</td>
              <td>
                <form method="POST" action="{{ url_for('delete', item_id=item.item_id, next=request.url) }}" style="display: inline;">
                  <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza de que deseja deletar este item?');">
                    Deletar
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- FIM CONTEÚDO PRINCIPAL -->

    <!-- Importa o Footer -->
    {% include 'footer.html' %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
