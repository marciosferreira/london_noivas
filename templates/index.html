<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>London Noivas - Aluguel de Vestidos</title>

    <!-- Google Analytics 4 (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23RSZ1SMRX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-23RSZ1SMRX');
    </script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'london-gold': '#C5A059',
                        'stone': {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917',
                        }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        .animate-fadeIn {
            animation: fadeIn 1.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4;
        }
        ::-webkit-scrollbar-thumb {
            background: #C5A059;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a38446;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans antialiased">

    <!-- Header -->
    <header id="main-header" class="absolute top-0 left-0 right-0 z-50 transition-all duration-300 bg-transparent py-6">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-12 h-12 rounded-sm overflow-hidden bg-white">
                    <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="London Noivas Logo" class="w-full h-full object-contain">
                </div>
                <h1 id="header-title" class="text-2xl font-serif tracking-widest text-white transition-colors duration-300">
                    LONDON NOIVAS
                </h1>
            </div>

            <nav class="hidden md:flex gap-8 items-center font-medium tracking-wide text-sm">
                <a href="#colecoes" class="nav-link text-white hover:text-london-gold transition-colors">DESTAQUES</a>
                <a href="{{ url_for('catalogo') }}" class="nav-link text-white hover:text-london-gold transition-colors">CATÁLOGO</a>
                <a href="#sobre" class="nav-link text-white hover:text-london-gold transition-colors">SOBRE</a>
                <a href="#contato" class="nav-link text-white hover:text-london-gold transition-colors">CONTATO</a>
                <a href="https://wa.me/5592993531943" onclick="trackWhatsAppClick('header')" class="bg-london-gold text-white px-6 py-2 rounded-full hover:bg-opacity-90 transition-all shadow-lg">
                    AGENDAR VISITA
                </a>
                
                {% if session.get('logged_in') %}
                <a href="{{ url_for('agenda') }}" class="bg-white/10 text-white px-4 py-2 rounded hover:bg-white/20 transition-all text-xs ml-4">
                    PAINEL
                </a>
                {% endif %}
            </nav>
            
            <button id="mobile-menu-btn" class="md:hidden text-london-gold focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 z-[60] bg-stone-900/95 backdrop-blur-sm transform translate-x-full transition-transform duration-300 md:hidden flex flex-col justify-center items-center">
        <button id="close-menu-btn" class="absolute top-6 right-6 text-white hover:text-london-gold transition-colors focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        <nav class="flex flex-col gap-8 text-center">
            <a href="/" class="text-2xl font-serif text-white hover:text-london-gold transition-colors" onclick="closeMobileMenu()">INÍCIO</a>
            <a href="#colecoes" class="text-2xl font-serif text-white hover:text-london-gold transition-colors" onclick="closeMobileMenu()">DESTAQUES</a>
            <a href="{{ url_for('catalogo') }}" class="text-2xl font-serif text-white hover:text-london-gold transition-colors" onclick="closeMobileMenu()">CATÁLOGO</a>
            <a href="#sobre" class="text-2xl font-serif text-white hover:text-london-gold transition-colors" onclick="closeMobileMenu()">SOBRE</a>
            <a href="#contato" class="text-2xl font-serif text-white hover:text-london-gold transition-colors" onclick="closeMobileMenu()">CONTATO</a>
            <a href="https://wa.me/5592993531943" onclick="trackWhatsAppClick('mobile_menu'); closeMobileMenu()" class="text-xl bg-london-gold text-white px-8 py-3 rounded-full hover:bg-white hover:text-london-gold transition-all shadow-lg mt-4">
                AGENDAR VISITA
            </a>
        </nav>
    </div>

    <main>
        <!-- Hero Section -->
        <section class="relative h-screen w-full flex items-center justify-center overflow-hidden">
            <!-- Background with overlay -->
            <div class="absolute inset-0 z-0">
                <img 
                    src="https://images.unsplash.com/photo-1583939003579-730e3918a45a?auto=format&fit=crop&q=80&w=2000" 
                    alt="Luxury wedding dress" 
                    class="w-full h-full object-cover object-top"
                />
                <div class="absolute inset-0 bg-black/40"></div>
            </div>

            <div class="relative z-10 text-center px-6 max-w-4xl animate-fadeIn">
                <span class="text-london-gold font-medium tracking-[0.3em] text-sm md:text-base mb-4 block">ELEGÂNCIA BRITÂNICA EM CADA DETALHE</span>
                <h2 class="text-5xl md:text-8xl text-white font-serif mb-6 leading-tight">
                    O Vestido dos Seus Sonhos <br/> Está Aqui
                </h2>
                <p class="text-stone-200 text-lg md:text-xl mb-10 max-w-2xl mx-auto font-light">
                    Aluguel de vestidos exclusivos para noivas, madrinhas e festas de gala. Viva uma experiência inesquecível com curadoria London Noivas.
                </p>
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <a href="#colecoes" class="bg-transparent border-2 border-white text-white px-10 py-4 rounded-sm font-semibold tracking-widest hover:bg-white hover:text-stone-900 transition-all">
                        VER DESTAQUES
                    </a>
                    <a href="{{ url_for('catalogo') }}" class="bg-transparent border-2 border-white text-white px-10 py-4 rounded-sm font-semibold tracking-widest hover:bg-white hover:text-stone-900 transition-all">
                        VER CATÁLOGO
                    </a>
                </div>
            </div>

            <div class="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-8 h-8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3" />
                </svg>
            </div>
        </section>

        <!-- Intro Section -->
        <section id="sobre" class="pt-12 pb-4 md:pt-24 md:pb-12 bg-white">
            <div class="container mx-auto px-6 flex flex-col md:flex-row items-center gap-16">
                <div class="md:w-1/2 flex justify-center">
                    <div class="relative w-full md:w-[80%]">
                        <div class="absolute -top-4 -left-4 w-24 h-24 border-t-2 border-l-2 border-london-gold z-10"></div>
                        <!-- Imagem que representa o showroom real da foto enviada -->
                        <img 
                            src="{{ url_for('static', filename='london_noivas_image.png') }}" 
                            alt="Showroom London Noivas" 
                            class="w-full shadow-2xl relative z-0 rounded-sm object-contain aspect-[2/3] bg-stone-100"
                        />
                        <div class="absolute -bottom-8 -right-8 bg-london-gold p-8 hidden md:block shadow-xl">
                            <p class="text-white font-serif text-2xl italic leading-tight">"Elegância é a única beleza que nunca desaparece."</p>
                            <p class="text-white/80 text-sm mt-3 tracking-widest uppercase font-bold">— Audrey Hepburn</p>
                        </div>
                    </div>
                </div>
                <div class="md:w-1/2 space-y-8">
                    <div class="space-y-2">
                        <span class="text-london-gold font-bold tracking-[0.3em] text-xs uppercase">Tradição & Luxo Britânico</span>
                        <h2 class="text-4xl md:text-6xl font-serif text-stone-800 leading-tight">London Noivas: Onde os sonhos tomam forma</h2>
                    </div>
                    <p class="text-stone-600 leading-relaxed text-lg font-light">
                        Inspirada no requinte das grandes boutiques de Londres, a London Noivas oferece uma experiência de aluguel de luxo sem precedentes. 
                        Nosso showroom foi projetado para ser o seu santuário, onde cada prova de vestido é um momento de celebração e descoberta da sua melhor versão.
                    </p>
                    <div class="pt-4 grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-stone-50 flex items-center justify-center text-london-gold border border-london-gold/20">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <span class="text-stone-700 font-medium text-sm tracking-wide">Atendimento Personalizado</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-stone-50 flex items-center justify-center text-london-gold border border-london-gold/20">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <span class="text-stone-700 font-medium text-sm tracking-wide">Peças Exclusivas Nacionais e Importadas</span>
                        </div>
                    </div>
                    <div class="pt-6">
                        <a href="https://www.google.com.br/search?sca_esv=b91b52423da4ab6e&cs=0&output=search&kgmid=/g/11ymffx4qh&q=London+Noivas+e+Madrinhas&shem=bdsle,shrtn&shndl=30&source=sh/x/kp/local/m1/1&kgs=74936c11b6f17298&utm_source=bdsle,shrtn,sh/x/kp/local/m1/1&kgs=74936c11b6f17298&utm_source=bdsle,shrtn,sh/x/kp/local/m1/1" target="_blank" class="inline-block border-b-2 border-london-gold text-stone-800 font-bold tracking-widest pb-1 hover:text-london-gold transition-colors" onclick="gtag('event', 'click_visit_store', {'event_category': 'engagement', 'event_label': 'visite_nossa_loja'});">
                            VISITE NOSSA LOJA
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vitrine (Collections) Section -->
        <section id="colecoes" class="pt-4 pb-12 md:pt-12 md:pb-24 bg-white">
            <div class="container mx-auto px-6 text-center mb-16">
                <h2 class="text-4xl md:text-6xl font-serif text-stone-800 mb-4">Destaques</h2>
                <div class="w-24 h-1 bg-london-gold mx-auto mb-6"></div>
                <p class="text-stone-500 max-w-xl mx-auto">
                    Uma seleção curada dos melhores tecidos e cortes, inspirada na alta costura europeia.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-6 container mx-auto">
                {% if itens %}
                    {% for item in itens %}
                    {# Image Logic #}
                    {% set ns = namespace(found=false, image_url='') %}
                    {% for field in fields_config if field.type == 'item_image_url' and field.preview and field.visible %}
                       {% set image_value = item.key_values[field.id] if item.key_values is defined and field.id in item.key_values else item[field.id] if field.id in item else '' %}
                       {% if image_value and image_value != 'N/A' and not ns.found %}
                           {% set ns.image_url = image_value %}
                           {% set ns.found = true %}
                       {% endif %}
                    {% endfor %}
                    
                    {# Price Logic #}
                    {% set ns.price_display = 'Consulte o preço do aluguel' %}
                    {% for field in fields_config if field.type in ['value', 'item_value'] %}
                       {% set price_val = item.key_values[field.id] if item.key_values is defined and field.id in item.key_values else item[field.id] if field.id in item else 0 %}
                       {% if price_val|float == 0 %}
                           {% set ns.price_display = 'Consulte o preço do aluguel' %}
                       {% else %}
                           {% set ns.price_display = 'R$ ' + (price_val|format_brl) + ' (aluguel)' %}
                       {% endif %}
                    {% endfor %}
                    
                    {# Title and Description Logic #}
                    {% set display_title = (item.title | default('') | string | trim) or (item.nome | default('') | string | trim) or (item.item_custom_id | default('') | string | trim) or 'Peça Exclusiva' %}
                    {% set display_desc = (item.item_description | default('') | string | trim) or (item.description | default('') | string | trim) or (item.item_obs | default('') | string | trim) or 'Sem descrição detalhada.' %}
                    
                    <div class="group relative overflow-hidden cursor-pointer shadow-lg hover:shadow-2xl transition-all duration-500"
                         onclick="openCatalogModalById('{{ item.item_id }}', 'featured')">
                        <script>
                            (function() {
                                window.catalogData = window.catalogData || {};
                                window.catalogData['{{ item.item_id }}'] = {
                                    imageUrl: {{ ns.image_url | tojson }},
                                    title: {{ display_title | tojson }},
                                    description: {{ display_desc | tojson }},
                                    price: {{ ns.price_display | tojson }},
                                    customId: {{ item.item_custom_id | default(item.item_id) | tojson }}
                                };
                            })();
                        </script>

                        <div class="aspect-[3/4] overflow-hidden bg-stone-200">
                             {% if ns.found %}
                                <img src="{{ ns.image_url }}" alt="Item Image" class="w-full h-full object-contain bg-gray-50 grayscale-[0.2] group-hover:grayscale-0 group-hover:scale-105 transition-all duration-700">
                             {% else %}
                                <div class="w-full h-full flex items-center justify-center text-stone-400 bg-stone-100">
                                    <span class="font-serif italic">Sem imagem</span>
                                </div>
                             {% endif %}
                        </div>
                        
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-all"></div>
                        
                        <div class="absolute bottom-0 left-0 right-0 p-8 text-white transform translate-y-4 group-hover:translate-y-0 transition-all">
                            <span class="text-xs tracking-[0.3em] uppercase mb-2 block text-london-gold font-bold">
                                {% if item.categoria %}
                                    {{ item.categoria }}
                                {% else %}
                                    EXCLUSIVO
                                {% endif %}
                            </span>
                            <h3 class="text-2xl font-serif mb-2 leading-tight">
                                {{ display_title }}
                            </h3>
                            <!-- Opcional: Mostrar preço ou outro detalhe no subtitle -->
                            <p class="text-sm opacity-0 group-hover:opacity-100 transition-opacity font-light">
                                Ver Detalhes
                            </p>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="col-span-full text-center py-12">
                        <p class="text-stone-500 text-lg">Nenhum item disponível no momento. Visite-nos em breve!</p>
                    </div>
                {% endif %}
            </div>
            
            <div class="mt-16 text-center">
                <a href="{{ url_for('catalogo') }}" class="inline-block border border-stone-800 text-stone-800 px-12 py-4 hover:bg-stone-800 hover:text-white transition-all tracking-widest font-bold">
                    VER CATÁLOGO
                </a>
            </div>
        </section>

        <!-- Features Section -->
        <section class="py-24 bg-stone-900 text-white">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-16">
                    <div class="flex flex-col items-center text-center group">
                        <div class="text-london-gold mb-6 group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-serif mb-4 tracking-wider">Ajuste Sob Medida</h3>
                        <p class="text-stone-400 font-light leading-relaxed">
                            Costureiras especializadas garantem que o vestido fique perfeito no seu corpo.
                        </p>
                    </div>
                    <div class="flex flex-col items-center text-center group">
                        <div class="text-london-gold mb-6 group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-serif mb-4 tracking-wider">Acessórios Disponíveis</h3>
                        <p class="text-stone-400 font-light leading-relaxed">
                            Aluguel completo com véu, grinalda, bolsa, e outros acessórios selecionadas para o seu estilo.
                        </p>
                    </div>
                    <div class="flex flex-col items-center text-center group">
                        <div class="text-london-gold mb-6 group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-serif mb-4 tracking-wider">Curadoria Exclusiva</h3>
                        <p class="text-stone-400 font-light leading-relaxed">
                            Modelos trazidos dos melhores fornecdores do Braisl e do mundo
                        </p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Showroom AI Section (Static) -->
        <section id="showroom" class="py-20 bg-stone-100">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row items-center gap-12 transition-all duration-500">
                    <div id="chat-wrapper" class="w-full space-y-6 transition-all duration-500">
                        <span class="text-london-gold font-bold tracking-widest text-sm">BUSCA INTELIGENTE</span>
                        <h2 class="text-4xl md:text-5xl font-serif text-stone-800">Encontre seu vestido ideal</h2>
                        <p class="text-stone-600 leading-relaxed">
                            Converse com nossa assistente virtual. Descreva o que você procura e nossa inteligência artificial encontrará as melhores opções do nosso acervo para você.
                        </p>
                        
                        <div id="chat-box-container" class="bg-white rounded-sm shadow-lg border border-stone-200 overflow-hidden flex flex-col h-[400px]">
                            <!-- Chat Area -->
                            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-stone-50">
                                <div class="flex gap-3">
                                    <div class="w-8 h-8 rounded-full bg-london-gold flex items-center justify-center text-white flex-shrink-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                                        </svg>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm text-sm text-stone-700 max-w-[85%] border border-stone-100">
                                        Olá! Sou sua consultora virtual Bella. Me conte, como é o vestido dos seus sonhos? (Ex: "Procuro um vestido sereia com brilho para um casamento à noite")
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Input Area -->
                            <div class="p-4 bg-white border-t border-stone-200">
                                <div class="flex gap-2">
                                    <button onclick="resetChat()" class="p-2 text-stone-400 hover:text-stone-600 transition-colors" title="Nova Conversa">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                        </svg>
                                    </button>
                                    <input 
                                        type="text" 
                                        id="chat-input"
                                        placeholder="Digite aqui..."
                                        class="flex-1 p-3 border border-stone-300 rounded-sm focus:ring-2 focus:ring-london-gold outline-none text-sm"
                                        onkeypress="handleEnter(event)"
                                    />
                                    <button onclick="sendMessage()" class="bg-stone-900 text-white px-4 py-2 rounded-sm hover:bg-london-gold transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hidden lg:w-1/2 w-full aspect-[3/4] bg-white rounded-lg shadow-2xl overflow-hidden flex items-center justify-center border-4 border-white relative transition-all duration-500" id="result-frame">
                        <!-- Result State (Hidden by default) -->
                        <div id="result-state" class="w-full h-full relative group">
                             <img id="result-image" src="" alt="Vestido Recomendado" class="w-full h-full object-contain" />
                             <div id="result-overlay" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 text-white">
                                <h3 id="result-title" class="text-xl font-serif mb-2">Vestido Recomendado</h3>
                                <p id="result-desc" class="text-sm font-light opacity-90 line-clamp-3"></p>
                             </div>
                        </div>
                    </div>
                </div>

                <!-- Suggestions Gallery (Hidden by default) -->
                <div id="suggestions-container" class="hidden mt-12 animate-fadeIn">
                    <h3 class="text-2xl font-serif text-stone-800 mb-6 text-center">Outras opções que combinam com sua necessidade</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="suggestions-grid">
                        <!-- Thumbnails will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Image Modal -->
            <div id="image-modal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                <!-- Background backdrop -->
                <div class="fixed inset-0 bg-stone-900/90 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>

                <div class="fixed inset-0 z-10 overflow-y-auto">
                    <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                        <div class="relative transform overflow-hidden rounded-sm bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
                            
                            <div class="absolute top-0 right-0 pt-4 pr-4 z-20">
                                <button type="button" class="rounded-full bg-white/20 p-2 text-stone-500 hover:text-stone-800 focus:outline-none" onclick="closeModal()">
                                    <span class="sr-only">Close</span>
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <div class="flex flex-col md:flex-row">
                                <div class="md:w-1/2 aspect-[3/4] bg-stone-100 relative">
                                    <img id="modal-image" src="" alt="Detail View" class="absolute inset-0 w-full h-full object-contain">
                                </div>
                                <div class="md:w-1/2 p-8 flex flex-col justify-center">
                                    <h3 class="text-2xl font-serif text-london-gold mb-4">Detalhes da Peça</h3>
                                    <p id="modal-desc" class="text-stone-600 font-light leading-relaxed text-lg"></p>
                                    
                                    <div class="mt-8 pt-6 border-t border-stone-100">
                                        <button onclick="closeModal(); document.getElementById('chat-input').focus();" class="w-full bg-stone-900 text-white py-4 hover:bg-london-gold transition-colors font-bold tracking-widest text-sm">
                                            VOLTAR PARA A CONVERSA
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                let conversationHistory = [];

                function resetChat() {
                    conversationHistory = [];
                    const container = document.getElementById('chat-messages');
                    container.innerHTML = `
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-london-gold flex items-center justify-center text-white flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                                </svg>
                            </div>
                            <div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm text-sm text-stone-700 max-w-[85%] border border-stone-100">
                                Olá! Sou sua consultora virtual Bella. Me conte, como é o vestido dos seus sonhos? (Ex: "Procuro um vestido sereia com brilho para um casamento à noite")
                            </div>
                        </div>
                    `;
                    
                    // Reset layout
                    const chatWrapper = document.getElementById('chat-wrapper');
                    const resultFrame = document.getElementById('result-frame');
                    
                    chatWrapper.classList.add('w-full');
                    chatWrapper.classList.remove('lg:w-1/2');
                    
                    resultFrame.classList.add('hidden');
                    
                    document.getElementById('suggestions-container').classList.add('hidden');
                }

                function handleEnter(e) {
                    if (e.key === 'Enter') sendMessage();
                }

                async function sendMessage() {
                    const input = document.getElementById('chat-input');
                    const message = input.value.trim();
                    if (!message) return;

                    addMessage(message, 'user');
                    input.value = '';
                    conversationHistory.push({ role: "user", content: message });
                    const loadingId = addLoading();

                    try {
                        const response = await fetch('/api/ai-search', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                message: message,
                                history: conversationHistory 
                            })
                        });
                        
                        const data = await response.json();
                        removeMessage(loadingId);
                        
                        if (data.reply) {
                            addMessage(data.reply, 'bot');
                            conversationHistory.push({ role: "assistant", content: data.reply });
                        }
                        
                        if (data.dress) {
                            showResult(data.dress, data.suggestions);
                        } else if (data.error) {
                            addMessage("Desculpe, ocorreu um erro: " + data.error, 'bot');
                        }

                    } catch (error) {
                        removeMessage(loadingId);
                        addMessage("Desculpe, tive um problema de conexão. Tente novamente.", 'bot');
                        console.error(error);
                    }
                }

                function addMessage(text, sender) {
                    const container = document.getElementById('chat-messages');
                    const div = document.createElement('div');
                    div.className = "flex gap-3 " + (sender === 'user' ? "flex-row-reverse" : "");
                    
                    const avatar = sender === 'bot' 
                        ? `<div class="w-8 h-8 rounded-full bg-london-gold flex items-center justify-center text-white flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" /></svg></div>`
                        : `<div class="w-8 h-8 rounded-full bg-stone-200 flex items-center justify-center text-stone-600 flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg></div>`;
                    
                    const bubbleClass = sender === 'bot' 
                        ? "bg-white text-stone-700 rounded-tl-none border-stone-100" 
                        : "bg-stone-800 text-white rounded-tr-none";
                        
                    div.innerHTML = `
                        ${avatar}
                        <div class="${bubbleClass} p-3 rounded-lg shadow-sm text-sm max-w-[85%] border">
                            ${text}
                        </div>
                    `;
                    
                    container.appendChild(div);
                    container.scrollTop = container.scrollHeight;
                }

                function addLoading() {
                    const id = 'loading-' + Date.now();
                    const container = document.getElementById('chat-messages');
                    const div = document.createElement('div');
                    div.id = id;
                    div.className = "flex gap-3";
                    div.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-london-gold flex items-center justify-center text-white flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 animate-spin"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" /></svg>
                        </div>
                        <div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm text-sm text-stone-500 border border-stone-100 flex items-center gap-2">
                            <span class="italic">Consultando a Bella</span>
                            <div class="flex space-x-1 h-3 items-center">
                                <div class="w-2 h-2 bg-london-gold rounded-full animate-bounce" style="animation-delay: 0s"></div>
                                <div class="w-2 h-2 bg-london-gold rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-london-gold rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                    container.scrollTop = container.scrollHeight;
                    return id;
                }

                function removeMessage(id) {
                    const el = document.getElementById(id);
                    if (el) el.remove();
                }

                function showResult(dress, suggestions) {
                    const chatWrapper = document.getElementById('chat-wrapper');
                    const resultFrame = document.getElementById('result-frame');
                    const img = document.getElementById('result-image');
                    const title = document.getElementById('result-title');
                    const desc = document.getElementById('result-desc');

                    // Adjust layout
                    chatWrapper.classList.remove('w-full');
                    chatWrapper.classList.add('lg:w-1/2');
                    
                    resultFrame.classList.remove('hidden');
                    
                    img.src = dress.image_url;
                    title.textContent = "Recomendação Principal";
                    desc.textContent = dress.description;

                    // Ensure overlay is visible when new result comes in
                    const overlay = document.getElementById('result-overlay');
                    if (overlay) overlay.classList.remove('hidden');

                    // Add click handler to open details
                    const imgContainer = img.parentElement;
                    imgContainer.style.cursor = "pointer";
                    imgContainer.onclick = () => {
                        // Hide overlay on click
                        if (overlay) overlay.classList.add('hidden');
                        
                        openCatalogModal(
                        dress.image_url, 
                        dress.title || "Sugestão Exclusiva", 
                        dress.description, 
                        dress.id, 
                        dress.price || "Consulte o preço do aluguel",
                        'ai_result',
                        dress.customId
                    )};

                    if (suggestions && suggestions.length > 0) {
                        showSuggestions(suggestions);
                    }
                }

                function showSuggestions(suggestions) {
                    const container = document.getElementById('suggestions-container');
                    const grid = document.getElementById('suggestions-grid');
                    grid.innerHTML = ''; // Limpa anteriores

                    suggestions.forEach((item, index) => {
                        if(index >= 8) return; // Limite de 8 (2 linhas no desktop)
                        const div = document.createElement('div');
                        div.className = "aspect-[3/4] bg-stone-200 cursor-pointer overflow-hidden rounded-sm relative group";
                        div.onclick = () => openCatalogModal(
                            item.image_url, 
                            item.title || "Sugestão Exclusiva", 
                            item.description, 
                            item.id, 
                            item.price || "Consulte o preço do aluguel",
                            'ai_suggestion',
                            item.customId
                        );
                        
                        div.innerHTML = `
                            <img src="${item.image_url}" class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-500" alt="Sugestão">
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex items-center justify-center">
                                <span class="text-white opacity-0 group-hover:opacity-100 font-serif tracking-widest text-xs border border-white px-3 py-1">VER DETALHES</span>
                            </div>
                        `;
                        grid.appendChild(div);
                    });
                    
                    container.classList.remove('hidden');
                }

                function openModal(item) {
                    const modal = document.getElementById('image-modal');
                    document.getElementById('modal-image').src = item.image_url;
                    document.getElementById('modal-desc').textContent = item.description;
                    modal.classList.remove('hidden');
                }

                function closeModal() {
                    document.getElementById('image-modal').classList.add('hidden');
                }
            </script>
                </div>
            </div>
        </section>

        <!-- Testimonials -->
        <section class="py-24 bg-stone-50 overflow-hidden">
            <div class="container mx-auto px-6 text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-serif text-stone-800">Experiências London Noivas</h2>
                <div class="w-20 h-0.5 bg-london-gold mx-auto mt-4"></div>
            </div>
            <div class="flex flex-wrap justify-center gap-8">
                <!-- Testimonial 1 -->
                <div class="bg-white p-10 rounded-sm shadow-sm max-w-sm border-t-4 border-london-gold">
                    <div class="flex justify-center mb-6">
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                    </div>
                    <p class="text-stone-600 italic mb-6 leading-relaxed">"O atendimento foi impecável. O vestido parecia ter sido feito no meu corpo."</p>
                    <div class="font-bold text-stone-800 tracking-widest text-sm uppercase">Mariana Silva</div>
                    <div class="text-london-gold text-xs mt-1 uppercase font-bold tracking-tighter">Noiva 2023</div>
                </div>

                <!-- Testimonial 2 -->
                <div class="bg-white p-10 rounded-sm shadow-sm max-w-sm border-t-4 border-london-gold">
                    <div class="flex justify-center mb-6">
                        <!-- Stars -->
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                    </div>
                    <p class="text-stone-600 italic mb-6 leading-relaxed">"A London Noivas superou todas as minhas expectativas. O acervo é maravilhoso."</p>
                    <div class="font-bold text-stone-800 tracking-widest text-sm uppercase">Beatriz Costa</div>
                    <div class="text-london-gold text-xs mt-1 uppercase font-bold tracking-tighter">Madrinha</div>
                </div>

                <!-- Testimonial 3 -->
                <div class="bg-white p-10 rounded-sm shadow-sm max-w-sm border-t-4 border-london-gold">
                    <div class="flex justify-center mb-6">
                        <!-- Stars -->
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        <svg class="w-4 h-4 text-london-gold fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                    </div>
                    <p class="text-stone-600 italic mb-6 leading-relaxed">"Amei o showroom de IA! Me ajudou muito a decidir o que eu queria."</p>
                    <div class="font-bold text-stone-800 tracking-widest text-sm uppercase">Fernanda Lima</div>
                    <div class="text-london-gold text-xs mt-1 uppercase font-bold tracking-tighter">Debutante</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="contato" class="bg-stone-50 pt-20 pb-10 border-t border-stone-200">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                <div class="col-span-1 md:col-span-2">
                    <h2 class="text-3xl font-serif mb-6 tracking-widest text-stone-800">LONDON NOIVAS</h2>
                    <p class="text-stone-500 mb-8 max-w-sm">
                        Tornando momentos especiais em memórias eternas através da elegância e sofisticação que você merece.
                    </p>
                    <div class="flex gap-4">
                        <a href="https://instagram.com/londonnoivas" target="_blank" class="flex items-center gap-3 group">
                            <div class="w-10 h-10 border border-stone-300 rounded-full flex items-center justify-center group-hover:bg-london-gold group-hover:text-white group-hover:border-london-gold transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.281.11-.705.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.486-.276a2.478 2.478 0 0 1-.919-.598 2.48 2.48 0 0 1-.599-.92c-.11-.281-.24-.705-.275-1.485-.038-.843-.047-1.096-.047-3.232 0-2.136.009-2.388.047-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"/>
                                </svg>
                            </div>
                            <span class="text-stone-500 font-bold text-sm tracking-widest group-hover:text-london-gold transition-colors">@londonnoivas</span>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-stone-800 mb-6 tracking-widest uppercase text-sm">Onde Estamos</h4>
                    <ul class="space-y-4 text-stone-500 text-sm mb-6">
                        <li>Rua Voltaire, 9</li>
                        <li>Colônia Santo Antônio - Manaus - AM</li>
                        <li>Seg - Sáb: 10h às 20h</li>
                        <li>Tel/WhatsApp: <span id="phone-display-index" class="cursor-pointer underline decoration-dotted text-london-gold" onclick="revealPhone('phone-display-index')">Ver número</span></li>
                    </ul>
                    <div class="rounded-sm overflow-hidden shadow-md border border-stone-200">
                        <a href="https://maps.app.goo.gl/iTZXMqYrz5CS9Xax6" target="_blank" onclick="gtag('event', 'map_click', {'event_category': 'contact', 'event_label': 'footer'});" class="block w-full h-[200px] bg-stone-100">
                            <img src="{{ url_for('static', filename='mapa.png') }}" alt="Localização London Noivas" class="w-full h-full object-cover hover:opacity-90 transition-opacity">
                        </a>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-stone-800 mb-6 tracking-widest uppercase text-sm">Links Rápidos</h4>
                    <ul class="space-y-4 text-stone-500 text-sm">
                        <li><a href="#colecoes" class="hover:text-london-gold transition-colors">Destaques</a></li>
                        <li><a href="{{ url_for('catalogo') }}" class="hover:text-london-gold transition-colors">Catálogo Completo</a></li>
                        <li><a href="#showroom" class="hover:text-london-gold transition-colors">Estilista Virtual</a></li>
                        <li><a href="https://wa.me/5592993531943" target="_blank" onclick="trackWhatsAppClick('footer_link')" class="hover:text-london-gold transition-colors">Agendamento/Dúvidas</a></li>
                        <li>
                             {% if not session.get('logged_in') %}
                             <a href="{{ url_for('login') }}" class="hover:text-london-gold transition-colors">Área Restrita</a>
                             {% else %}
                             <a href="{{ url_for('agenda') }}" class="hover:text-london-gold transition-colors">Painel Admin</a>
                             {% endif %}
                        </li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-stone-200 pt-8 text-center text-stone-400 text-xs">
                <p>&copy; 2025 London Noivas. Todos os direitos reservados. Desenvolvido com sofisticação.</p>
            </div>
        </div>
        
        <!-- Floating AI Stylist CTA -->
        <div id="ai-stylist-cta" class="fixed bottom-32 right-8 z-50 group">
            <!-- The Chat Bubble (Hidden by default, shown on hover/focus) -->
            <div id="ai-cta-bubble" class="absolute bottom-full right-0 mb-4 bg-white p-5 rounded-lg shadow-2xl border-l-4 border-london-gold w-80 transform scale-0 opacity-0 group-hover:scale-100 group-hover:opacity-100 group-focus-within:scale-100 group-focus-within:opacity-100 transition-all duration-300 origin-bottom-right">
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-serif text-london-gold font-bold text-lg">Estilista Virtual</h4>
                    <span class="text-xs bg-stone-100 text-stone-500 px-2 py-1 rounded-full">Beta</span>
                </div>
                <p class="text-sm text-stone-600 mb-4 font-light leading-relaxed">
                    Olá! Sou a Bella. Vou te ajudar a escolher o vestido dos seus sonhos.
                    <span class="block text-xs text-stone-400 mt-2 italic border-t border-stone-100 pt-2">Ex: "Procuro um vestido sereia com brilho para um casamento à noite"</span>
                </p>
                <div class="flex gap-2 relative">
                    <input type="text" id="ai-cta-input" placeholder="Digite aqui..." 
                           class="w-full text-sm border border-stone-200 rounded-sm px-3 py-2 pr-10 focus:border-london-gold focus:ring-1 focus:ring-london-gold outline-none transition-all"
                           onkeypress="handleAiCtaEnter(event)">
                    <button onclick="submitAiCta()" class="absolute right-2 top-1/2 -translate-y-1/2 text-london-gold hover:text-stone-800 transition-colors p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                        </svg>
                    </button>
                </div>
            </div>
        
            <!-- The Icon Trigger -->
            <button class="bg-stone-900 text-white p-4 rounded-full shadow-2xl hover:bg-london-gold transition-colors relative group-hover:rotate-12 duration-300">
                <!-- Notification Dot -->
                <span class="absolute -top-1 -right-1 flex h-4 w-4">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-london-gold opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-4 w-4 bg-london-gold border-2 border-white"></span>
                </span>
                
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 00-1.423 1.423z" />
                </svg>
            </button>
        </div>

        <script>
            function handleAiCtaEnter(e) {
                if (e.key === 'Enter') submitAiCta();
            }
        
            function submitAiCta() {
                const ctaContainer = document.getElementById('ai-stylist-cta');
                const ctaInput = document.getElementById('ai-cta-input');
                const mainInput = document.getElementById('chat-input');
                const bubble = document.getElementById('ai-cta-bubble');
                const text = ctaInput.value.trim();
        
                if (text) {
                    // Close bubble and remove focus
                    ctaInput.blur();
                    if (bubble) {
                        bubble.style.setProperty('transform', 'scale(0)', 'important');
                        bubble.style.setProperty('opacity', '0', 'important');
                    }

                    // Scroll to chat box
                    const chatBox = document.getElementById('chat-box-container');
                    if (chatBox) {
                        chatBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        const showroom = document.getElementById('showroom');
                        showroom.scrollIntoView({ behavior: 'smooth' });
                    }
        
                    // Set value and send
                    setTimeout(() => {
                        mainInput.value = text;
                        // Trigger input event to resize if needed (not needed here but good practice)
                        mainInput.focus();
                        sendMessage();
                        
                        // Fix for mobile sticky hover: Replace the element to clear state
                        if (ctaContainer) {
                            const newCta = ctaContainer.cloneNode(true);
                            // Clear input in the new element
                            const newInput = newCta.querySelector('#ai-cta-input');
                            if (newInput) newInput.value = '';
                            
                            // Reset styles in the new element (remove inline overrides so CSS takes over, but clean state)
                            const newBubble = newCta.querySelector('#ai-cta-bubble');
                            if (newBubble) {
                                newBubble.style.removeProperty('transform');
                                newBubble.style.removeProperty('opacity');
                            }
                            
                            ctaContainer.parentNode.replaceChild(newCta, ctaContainer);
                        }
                    }, 800);
                }
            }
        </script>

        <!-- Floating WhatsApp CTA -->
        <a href="https://wa.me/5592993531943" onclick="trackWhatsAppClick('floating_cta')" class="fixed bottom-8 right-8 bg-green-500 text-white p-4 rounded-full shadow-2xl hover:scale-110 transition-transform z-50 flex items-center gap-2 group">
            <span class="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-500 whitespace-nowrap font-bold">
                Agendamento/Dúvidas
            </span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.588-5.946 0-6.556 5.332-11.891 11.891-11.891 3.181 0 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.481 8.403 0 6.556-5.332 11.892-11.891 11.892-1.999 0-3.956-.503-5.692-1.448l-6.301 1.666zm6.29-4.143c1.589.943 3.197 1.441 4.934 1.441 5.485 0 9.95-4.465 9.95-9.95 0-2.652-1.036-5.147-2.919-7.031-1.883-1.883-4.384-2.917-7.031-2.917-5.485 0-9.951 4.465-9.951 9.95 0 2.07.635 4.089 1.835 5.823l-1.101 4.022 4.133-1.092zm10.293-7.234c-.298-.15-1.764-.871-2.037-.972-.273-.102-.472-.152-.671.152-.199.303-.771 1.018-.944 1.219-.174.202-.348.227-.646.077-.298-.15-1.258-.464-2.396-1.48-.885-.789-1.483-1.763-1.656-2.064-.174-.302-.018-.465.132-.614.135-.133.298-.348.447-.521.149-.174.199-.298.298-.497.099-.198.05-.373-.025-.522-.075-.15-.671-1.616-.919-2.213-.242-.581-.486-.502-.671-.512-.174-.01-.373-.013-.572-.013-.199 0-.523.075-.795.373-.273.302-1.045 1.018-1.045 2.486s1.07 2.885 1.219 3.085c.149.202 2.105 3.214 5.099 4.507.712.308 1.268.491 1.701.628.715.227 1.365.195 1.879.118.573-.086 1.764-.72 2.013-1.417.248-.696.248-1.292.174-1.417-.074-.125-.272-.201-.57-.352z"/>
            </svg>
        </a>
    </footer>

    <!-- Header Scroll Effect Script -->
    <script>
        const header = document.getElementById('main-header');
        const headerTitle = document.getElementById('header-title');
        const navLinks = document.querySelectorAll('.nav-link');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.remove('bg-transparent', 'py-6');
                header.classList.add('bg-white', 'shadow-md', 'py-3');
                
                headerTitle.classList.remove('text-white');
                headerTitle.classList.add('text-stone-800');
                
                navLinks.forEach(link => {
                    link.classList.remove('text-white');
                    link.classList.add('text-stone-600');
                });
            } else {
                header.classList.add('bg-transparent', 'py-6');
                header.classList.remove('bg-white', 'shadow-md', 'py-3');
                
                headerTitle.classList.add('text-white');
                headerTitle.classList.remove('text-stone-800');
                
                navLinks.forEach(link => {
                    link.classList.add('text-white');
                    link.classList.remove('text-stone-600');
                });
            }
        });
    </script>
    <!-- Catalog Modal -->
    <div id="catalog-modal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-stone-900/90 transition-opacity backdrop-blur-sm" onclick="closeCatalogModal()"></div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-sm bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl animate-fadeIn">
                    
                    <div class="absolute top-0 right-0 pt-4 pr-4 z-20">
                        <button type="button" class="rounded-full bg-white/20 p-2 text-stone-500 hover:text-stone-800 focus:outline-none transition-colors" onclick="closeCatalogModal()">
                            <span class="sr-only">Fechar</span>
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <div class="flex flex-col md:flex-row h-full md:h-[80vh]">
                        <!-- Image Side -->
                <div class="md:w-1/2 bg-stone-100 relative h-[50vh] md:h-full group cursor-zoom-in" onclick="openFullImage(document.getElementById('catalog-modal-img').src)">
                    <img id="catalog-modal-img" src="" alt="Detalhe" class="absolute inset-0 w-full h-full object-contain transition-transform duration-500 hover:scale-105">
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-12 h-12 drop-shadow-lg">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                        </svg>
                    </div>
                </div>
                        
                        <!-- Content Side -->
                        <div class="md:w-1/2 p-8 md:p-12 flex flex-col overflow-y-auto bg-white">
                            <div class="flex-1">
                                <span class="text-london-gold font-bold tracking-widest text-xs uppercase mb-2 block">London Noivas Collection</span>
                                <h3 id="catalog-modal-title" class="text-3xl md:text-4xl font-serif text-stone-900 mb-2 leading-tight"></h3>
                                <p id="catalog-modal-price" class="text-2xl text-stone-600 font-serif mb-2"></p>
                                <p class="text-xs text-stone-400 mb-6 font-mono">ID: <span id="catalog-modal-id-value"></span></p>
                                
                                <div class="w-12 h-1 bg-stone-200 mb-8"></div>
                                
                                <div class="prose prose-stone max-w-none">
                                    <h4 class="font-serif text-lg text-stone-800 mb-2">Descrição da Peça</h4>
                                    <p id="catalog-modal-desc" class="text-stone-600 font-light leading-relaxed text-lg mb-8"></p>
                                </div>

                                <!-- Similar Items Section -->
                                <div id="catalog-modal-similar-section" class="hidden mb-8">
                                    <div class="w-12 h-1 bg-stone-200 mb-6"></div>
                                    <h4 class="font-serif text-lg text-stone-800 mb-4">Você também pode gostar</h4>
                                    <div id="catalog-modal-similar-grid" class="grid grid-cols-2 gap-4">
                                        <!-- Similar items injected here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8 pt-8 border-t border-stone-100">
                                <p class="text-stone-400 text-sm mb-4 text-center italic">Gostou deste modelo? Fale conosco agora.</p>
                                <a id="catalog-modal-whatsapp-link" href="#" target="_blank" class="block w-full bg-[#25D366] hover:bg-[#1ebc57] text-white py-4 px-6 rounded-sm transition-colors text-center shadow-lg hover:shadow-xl transform hover:-translate-y-1 duration-200 flex items-center justify-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
                                    </svg>
                                    <span class="font-bold tracking-widest text-sm">SOLICITAR MAIS INFORMAÇÕES</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openCatalogModalById(itemId, source) {
            const data = window.catalogData && window.catalogData[itemId];
            if (data) {
                // Pass UUID as itemId, and customId as display param
                openCatalogModal(data.imageUrl, data.title, data.description, itemId, data.price, source, data.customId);
            } else {
                console.error('Dados do item não encontrados para ID:', itemId);
            }
        }

        function openCatalogModal(imageUrl, title, description, itemId, price, source, customDisplayId) {
            const idToShow = customDisplayId || itemId;

            // Handle Price Display Logic
            let displayPrice = price;
            if (!price || price === '0' || price === 0 || price === '0.00' || price === '0,00') {
                displayPrice = 'Consulte o preço do aluguel';
            }

            document.getElementById('catalog-modal-img').src = imageUrl || 'https://via.placeholder.com/600x800?text=Sem+Imagem';
            document.getElementById('catalog-modal-title').textContent = title;
            document.getElementById('catalog-modal-desc').textContent = description;
            document.getElementById('catalog-modal-price').textContent = displayPrice;
            document.getElementById('catalog-modal-id-value').textContent = idToShow;
            
            const phoneNumber = "5592993531943";
            
            // Construct message with Title and ID
            let text = `Olá, gostaria de mais informações sobre o vestido: ${title}`;
            text += `\nCód: ${idToShow}`;
            
            // Check if it's an AI item (starts with ai_) or regular item
            const isAiItem = itemId && itemId.toString().startsWith('ai_');

            // Always include Image URL
            const fullImageUrl = new URL(imageUrl, window.location.origin).href;
            text += `\nImagem: ${fullImageUrl}`;

            if (!isAiItem) {
                // Update URL to include item_id (UUID) for regular items
                const url = new URL(window.location);
                url.searchParams.set('item', itemId);
                window.history.pushState({}, '', url);
                text += `\nLink: ${url.toString()}`;
            }

            const encodedText = encodeURIComponent(text);
            const whatsappLink = document.getElementById('catalog-modal-whatsapp-link');
            whatsappLink.href = `https://wa.me/${phoneNumber}?text=${encodedText}`;
            
            // Dynamic tracking based on source (AI, Featured, or Catalog)
            if (source === 'featured') {
                whatsappLink.onclick = function() { trackWhatsAppClick('featured_modal_whatsapp'); };
            } else if (isAiItem) {
                whatsappLink.onclick = function() { trackWhatsAppClick('ai_modal_whatsapp'); };
            } else {
                whatsappLink.onclick = function() { trackWhatsAppClick('catalog_modal_whatsapp'); };
            }
            
            document.getElementById('catalog-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling

            // Reset and fetch similar items
            const similarSection = document.getElementById('catalog-modal-similar-section');
            const similarGrid = document.getElementById('catalog-modal-similar-grid');
            similarSection.classList.add('hidden');
            similarGrid.innerHTML = '';

            if (itemId && !isAiItem) {
                // Increment visit count for all sources
                fetch(`/api/item/${itemId}/visit`, { method: 'POST' })
                    .catch(err => console.error('Error incrementing visit count:', err));

                fetch(`/api/ai-similar/${itemId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.suggestions && data.suggestions.length > 0) {
                            data.suggestions.forEach(item => {
                                const div = document.createElement('div');
                                div.className = 'cursor-pointer group';
                                div.onclick = () => openCatalogModal(item.image_url, item.title, item.description, item.id, 'Consulte o preço do aluguel', 'similar', item.customId);
                                div.innerHTML = `
                                    <div class="aspect-[3/4] bg-stone-100 overflow-hidden mb-2 rounded-sm relative">
                                        <img src="${item.image_url}" class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-110" alt="${item.title}">
                                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div>
                                    </div>
                                    <p class="text-xs font-bold text-stone-800 uppercase tracking-wide truncate">${item.title}</p>
                                `;
                                similarGrid.appendChild(div);
                            });
                            similarSection.classList.remove('hidden');
                        }
                    })
                    .catch(err => console.error('Erro ao buscar similares:', err));
            }
        }

        function closeCatalogModal() {
            document.getElementById('catalog-modal').classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
            
            // Remove item param from URL
            const url = new URL(window.location);
            url.searchParams.delete('item');
            window.history.pushState({}, '', url);
        }

        // Check URL for item param on load
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const itemId = urlParams.get('item');
            if (itemId && window.catalogData && window.catalogData[itemId]) {
                const item = window.catalogData[itemId];
                openCatalogModal(item.imageUrl, item.title, item.description, itemId, item.price, 'url_load', item.customId);
            }
        });
    </script>
    <!-- Analytics Tracking Scripts -->
    <script>
        // Google Analytics 4 Event Tracking
        const GA_MEASUREMENT_ID = 'G-23RSZ1SMRX';

        function trackEvent(eventName, params) {
            console.log('Event Tracked:', eventName, params);
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, params);
            }
        }

        function trackWhatsAppClick(location) {
            trackEvent('whatsapp_click', {
                'event_category': 'contact',
                'event_label': location,
                'transport_type': 'beacon'
            });
        }

        function revealPhone(elementId) {
            const phoneSpan = document.getElementById(elementId);
            if (phoneSpan) {
                phoneSpan.innerText = '(92) 99353-1943';
                phoneSpan.classList.remove('cursor-pointer', 'underline', 'decoration-dotted', 'text-london-gold');
                phoneSpan.classList.add('text-stone-800');
                phoneSpan.onclick = null; // Remove click handler
                
                trackEvent('phone_reveal', {
                    'event_category': 'contact',
                    'event_label': 'footer_phone'
                });
            }
        }

        // Mobile Menu Logic
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        function openMobileMenu() {
            if (mobileMenu) mobileMenu.classList.remove('translate-x-full');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeMobileMenu() {
            if (mobileMenu) mobileMenu.classList.add('translate-x-full');
            document.body.style.overflow = ''; // Restore scrolling
        }

        if(mobileMenuBtn) mobileMenuBtn.addEventListener('click', openMobileMenu);
        if(closeMenuBtn) closeMenuBtn.addEventListener('click', closeMobileMenu);
    </script>
    <!-- Full Screen Image Modal -->
    <div id="full-image-modal" class="fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="closeFullImage()"></div>
        
        <button onclick="closeFullImage()" class="absolute top-4 right-4 z-[210] text-white/70 hover:text-white transition-colors p-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <img id="full-image-img" src="" alt="Full Screen" class="max-w-full max-h-full object-contain shadow-2xl pointer-events-auto rounded-sm">
        </div>
    </div>

    <script>
        function openFullImage(src) {
            if (!src || src.includes('placeholder')) return;
            const modal = document.getElementById('full-image-modal');
            const img = document.getElementById('full-image-img');
            img.src = src;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeFullImage() {
            const modal = document.getElementById('full-image-modal');
            modal.classList.add('hidden');
            // Only restore scrolling if catalog modal is not open, but since catalog modal also locks scrolling, 
            // we should check if catalog modal is open.
            // However, simplistically, if catalog modal is open, it handles its own overflow.
            // But we can just set it back to hidden, which usually defaults to 'auto' on body remove,
            // but here we are stacking modals.
            
            // If catalog modal is open, keep body overflow hidden.
            const catalogModal = document.getElementById('catalog-modal');
            if (catalogModal && !catalogModal.classList.contains('hidden')) {
                // Keep hidden
            } else {
                document.body.style.overflow = '';
            }
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const fullModal = document.getElementById('full-image-modal');
                if (!fullModal.classList.contains('hidden')) {
                    closeFullImage();
                }
            }
        });
    </script>
    <!-- Full Screen Image Modal -->
    <div id="full-image-modal" class="fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-md" onclick="closeFullImage()"></div>
        
        <button onclick="closeFullImage()" class="absolute top-4 right-4 z-[210] text-white/70 hover:text-white transition-colors p-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <img id="full-image-img" src="" alt="Full Screen" class="max-w-full max-h-full object-contain shadow-2xl pointer-events-auto rounded-sm">
        </div>
    </div>

    <script>
        function openFullImage(src) {
            if (!src || src.includes('placeholder')) return;
            const modal = document.getElementById('full-image-modal');
            const img = document.getElementById('full-image-img');
            img.src = src;
            modal.classList.remove('hidden');
            // Keep body overflow hidden (already set by catalog modal)
        }

        function closeFullImage() {
            const modal = document.getElementById('full-image-modal');
            modal.classList.add('hidden');
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const fullModal = document.getElementById('full-image-modal');
                if (!fullModal.classList.contains('hidden')) {
                    closeFullImage();
                    event.stopPropagation(); // Prevent closing the underlying catalog modal
                }
            }
        });
    </script>
</body>
</html>