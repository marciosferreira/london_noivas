<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Vestidos Alugados</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style_main.css') }}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body class="index_page">
    <!-- Exibir mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %}
    <div>
      {% for category, message in messages %}
      <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Título -->
    <h1 class="text-center my-4">Vestidos Alugados</h1>

    <!-- Botões -->
    <div class="mb-3 text-center">
      <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
      <a href="{{ url_for('returned') }}" class="btn btn-secondary">Arquivados</a>
      <a href="{{ url_for('add', next=request.url) }}" class="btn btn-primary">Adicionar Item</a>
      <a href="{{ url_for('reports') }}" class="btn btn-success">Financeiro</a>
    </div>

    <div class="table-responsive mb-4">


<!-- Filtros -->
    <div class="menu-filter">
      <button class="btn btn-info" id="filter-toggle">Filtros</button>

      <div id="filter-section" class="mt-3 d-none">
        <form method="GET" action="/">



          <div class="form-check">
            <input class="form-check-input" type="radio" name="filter" id="filter-todos" value="todos" {% if current_filter == 'todos' %}checked{% endif %}>
            <label class="form-check-label" for="filter-todos">Todos</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="filter" id="filter-reservados" value="reservados" {% if current_filter == 'reservados' %}checked{% endif %}>
            <label class="form-check-label" for="filter-reservados">Reservados</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="filter" id="filter-retirados" value="retirados" {% if current_filter == 'retirados' %}checked{% endif %}>
            <label class="form-check-label" for="filter-retirados">Retirados</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="filter" id="filter-atrasados" value="atrasados" {% if current_filter == 'atrasados' %}checked{% endif %}>
            <label class="form-check-label" for="filter-atrasados">Devolução atrasada</label>
          </div>


          <div class="mt-3">
            <label for="description" class="form-label">Descrição:</label>
            <input type="text" class="form-control" id="description" name="description" value="{{ request.args.get('description', '') }}">
          </div>

          <div class="mt-3">
            <label for="client-name" class="form-label">Nome do Cliente:</label>
            <input type="text" class="form-control" id="client-name" name="client_name" value="{{ request.args.get('client_name', '') }}">
          </div>



          <div class="mt-3">
            <label for="payment-status" class="form-label">Pagamento:</label>
            <select class="form-select" id="payment-status" name="payment">
              <option value="">Todos</option>
              <option value="Não pago" {% if request.args.get('payment') == 'Não pago' %}selected{% endif %}>Não Pago</option>
              <option value="Pago 50%" {% if request.args.get('payment') == 'Pago 50%' %}selected{% endif %}>Pago 50%</option>
              <option value="Pago 100%" {% if request.args.get('payment') == 'Pago 100%' %}selected{% endif %}>Pago 100%</option>
            </select>
          </div>

          <div class="row mt-3">
            <div class="col">
              <label for="start-date" class="form-label">Retir. prevista (de):</label>
              <input type="date" class="form-control" id="start-date" name="start_date" value="{{ request.args.get('start_date', '') }}">
            </div>
            <div class="col">
              <label for="end-date" class="form-label">Retir. prevista (até):</label>
              <input type="date" class="form-control" id="end-date" name="end_date" value="{{ request.args.get('end_date', '') }}">
            </div>
          </div>

          <div class="row mt-3">
            <div class="col">
              <label for="return-start-date" class="form-label">Devol. prevista (de):</label>
              <input type="date" class="form-control" id="return-start-date" name="return_start_date" value="{{ request.args.get('return_start_date', '') }}">
            </div>
            <div class="col">
              <label for="return-end-date" class="form-label">Devol. prevista (até):</label>
              <input type="date" class="form-control" id="return-end-date" name="return_end_date" value="{{ request.args.get('return_end_date', '') }}">
            </div>
          </div>

          <button type="submit" class="btn btn-primary mt-3">Aplicar Filtros</button>
        </form>
      </div>
    </div>

      <!-- Tabela -->
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Imagem</th>
              <th>Descrição</th>
              <th>Cliente</th>
              <th>Telefone</th>
              <th>Data de Retirada</th>
              <th>Data de Devolução</th>
              <th>Retirado</th>
              <th>Valor (R$)</th>
              <th>Pagamento</th>
              <th>Comentários</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for dress in dresses %}
            <tr class="{% if dress.overdue %}overdue{% elif dress.retirado %}retirado{% endif %}">
              <td data-label="Imagem">
                {% if dress.image_url and dress.image_url != "" %}
                <img src="{{ dress.image_url }}" alt="Imagem do vestido" class="img-fluid dress-thumbnail" />
                {% else %}
                <img src="{{ url_for('static', filename='dress-placeholder.png') }}" alt="Sem Imagem" class="img-fluid dress-thumbnail" />
                {% endif %}
              </td>
              <td data-label="Descrição">{{ dress.description }}</td>
              <td data-label="Cliente">{{ dress.client_name }}</td>
              <td data-label="Telefone">{{ dress.client_tel }}</td>
              <td data-label="Data de Retirada">{{ dress.rental_date_formatted }}</td>
              <td data-label="Data de Devolução">{{ dress.return_date_formatted }}</td>
              <td data-label="Retirado">{% if dress.retirado %} Sim {% else %} Não {% endif %}</td>
              <td data-label="Valor">{{ dress.valor }}</td>
              <td data-label="Pagamento">{{ dress.pagamento }}</td>
              <td data-label="Comentários">{{ dress.comments }}</td>

              <td data-label="Ações">
                <form method="POST" action="{{ url_for('delete', dress_id=dress.dress_id) }}" style="display: inline">
                  <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza de que deseja deletar este item?');">
                    Deletar
                  </button>
                </form>
                <a href="{{ url_for('edit', dress_id=dress.dress_id) }}" class="btn btn-warning btn-sm">Editar</a>
                <form method="POST" action="{{ url_for('mark_returned', dress_id=dress.dress_id) }}" style="display: inline">
                  <button type="submit" class="btn btn-success btn-sm">Arquivar</button>
                </form>
                <!-- Botão de replicação -->
                <a href="{{ url_for('replicate', dress_id=dress.dress_id, next=request.path) }}" class="btn btn-info btn-sm">Replicar</a>
              </td>


            </tr>

            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        {% set args = request.args.to_dict() %} <!-- Captura todos os argumentos da URL -->
        {% if page > 1 %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('index', **dict(args, page=page-1)) }}">Anterior</a>
        </li>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('index', **dict(args, page=p)) }}">{{ p }}</a>
        </li>
        {% endfor %}
        {% if page < total_pages %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('index', **dict(args, page=page+1)) }}">Próxima</a>
        </li>
        {% endif %}
      </ul>
    </nav>




    <!-- Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="imageModalLabel">Visualizar Imagem</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
            <img class="img-fluid" id="modalImg" alt="Imagem do Vestido" />
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const thumbnails = document.querySelectorAll('.dress-thumbnail');
      const modalImg = document.getElementById('modalImg');
      const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
      const filterToggle = document.getElementById('filter-toggle');
      const filterSection = document.getElementById('filter-section');
      const menuFilter = document.querySelector('.menu-filter'); // Captura o container do filtro

      // Função para alternar a visibilidade do filtro
      filterToggle.addEventListener('click', () => {
        filterSection.classList.toggle('d-none'); // Alterna a classe d-none para mostrar/ocultar
        filterSection.classList.toggle('active'); // Adiciona classe active para visibilidade
        menuFilter.style.height = 'auto'; // Garante que a altura do container se ajuste
      });

      // Função para exibir imagem no modal
      thumbnails.forEach((img) => {
        img.addEventListener('click', () => {
          modalImg.src = img.src;
          imageModal.show();
        });
      });
    </script>







  </body>
</html>
