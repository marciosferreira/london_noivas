<!-- Action Buttons Component -->
<div class="dropdown dropend">
  <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Ações</button>
  <ul class="dropdown-menu dropdown-menu-end">
    {% if show_rent %}
    <li>
      <a
        class="dropdown-item text-success"
        href="{{ url_for('rent', item_id=item.item_id, rent='true') }}"
        onclick="return checkTransactionLimit(event);"
      >
        Reservar/Retirar
      </a>
    </li>
    {% endif %} {% if show_mark_returned %}
    <li>
      <a
        class="dropdown-item text-success"
        href="{{ url_for('mark_returned', transaction_id=item.transaction_id, next=request.url) }}"
        onclick="return confirm('Tem certeza de que deseja marcar este item como devolvido?');"
      >
        Marcar como devolvido
      </a>
    </li>
    {% endif %} {% if show_mark_rented %}

    <!-- Botão rented com opcóes-->
    <a
      href="#"
      class="dropdown-item text-success"
      title="Retirar"
      onclick="confirmarAcao('{{ url_for('mark_rented', transaction_id=item.transaction_id, next=request.url) }}'); return false;"
    >
      Marcar como retirado
    </a>

    {% endif %} {% if show_edit_item %}
    <li><a class="dropdown-item" href="{{ url_for('edit_item', item_id=item.item_id, next=request.url) }}">Editar item</a></li>
    {% endif %} {% if show_edit_transaction %}
    <li>
      <a class="dropdown-item" href="{{ url_for('edit_transaction', transaction_id=item.transaction_id, next=request.url) }}">Editar transação</a>
    </li>
    {% endif %} {% if show_edit_client %}
    <li>
      <a
        class="dropdown-item"
        href="{{ url_for('editar_cliente', client_id=(cliente.client_id if cliente is defined else item.client_id), next=request.url) }}"
      >
        Editar cliente
      </a>
    </li>
    {% endif %} {% if show_view_transactions %}
    <li><a class="dropdown-item" href="{{ url_for('client_transactions', client_id=cliente.client_id) }}">Transações do cliente</a></li>
    {% endif %} {% if show_consult or show_ver_reservas %}
    <li><a class="dropdown-item" href="{{ url_for('view_calendar', item_id=item.item_id, next=request.url) }}">Ver reservas do item</a></li>
    {% endif %} {% if show_archive %}
    <li>
      <a
        class="dropdown-item"
        href="{{ url_for('mark_archived', item_id=item.item_id, next=request.url) }}"
        onclick="return confirm('Tem certeza de que deseja arquivar este item?');"
      >
        Arquivar item
      </a>
    </li>
    {% endif %} {% if show_restore %}
    <li>
      <a
        class="dropdown-item text-success"
        href="{{ url_for('restore_item', item_id=item.item_id, next=request.url) }}"
        onclick="return confirm('Tem certeza de que deseja restaurar este item?');"
      >
        Restaurar
      </a>
    </li>
    {% endif %} {% if show_mark_available %}

    <!-- Botão Disponível -->
    <a
      href="{{ url_for('mark_available', item_id=item.item_id, next=request.url) }}"
      class="dropdown-item"
      title="Tornar disponível"
      onclick="return confirm('Tem certeza que deseja tornar este item disponível novamente?');"
    >
      Diponibilizar item
    </a>
    {% endif %} {% if show_delete_item or show_delete_transaction %} {% endif %} {% if show_delete_item %}
    <li>
      <form method="POST" action="{{ url_for('delete', item_id=item.item_id, next=request.url) }}" style="display: inline">
        <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Tem certeza de que deseja deletar este item?');">
          Deletar item
        </button>
      </form>
    </li>
    {% endif %} {% if show_delete_client %}
    <li>
      <form
        method="POST"
        action="{{ url_for('deletar_cliente', client_id=cliente.client_id) }}"
        onsubmit="return confirm('Tem certeza que deseja deletar este cliente? Esta ação não poderá ser desfeita.');"
        style="display: inline"
      >
        <button type="submit" class="dropdown-item text-danger" title="Deletar">
          <i class="fas fa-trash"></i>
          Deletar cliente
        </button>
      </form>
    </li>
    {% endif %} {% if show_delete_transaction %}
    <li>
      <a
        class="dropdown-item text-danger"
        href="{{ url_for('delete_transaction', transaction_id=item.transaction_id, next=request.url) }}"
        onclick="return confirm('Tem certeza de que deseja deletar esta transação?');"
      >
        Deletar transação
      </a>
    </li>
    {% endif %}
  </ul>
</div>

<script>
  function checkTransactionLimit(event) {
    const totalTransactions = {{ total_relevant_transactions }};
    if (totalTransactions >= 30) {
      alert("O limite de transações simultâneas foi atingido. Entre em contato conosco.");
      event.preventDefault();
      return false;
    }
    return true;
  }
</script>
