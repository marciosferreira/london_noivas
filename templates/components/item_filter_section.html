<!-- Bloco: Botões superiores -->

<div class="d-flex justify-content-between align-items-center mb-3">
  <div class="d-flex flex-wrap gap-2 align-items-center justify-content-end w-100 w-sm-auto">
    {% if show_item_filter %}
    <!-- Botão de Filtros -->
    <a href="#" class="btn btn-outline-secondary" id="filter-toggle" onclick="toggleFilters(event)">Filtros</a>
    {% endif %} {% if show_add_item %}



    <!-- Botão sem tooltip -->
<a href="{{ add_route }}?next={{ request.url }}" class="btn btn-primary">
  <i class="fas fa-plus me-1"></i> Adicionar item
</a>



    {% endif %}
  </div>
</div>
<!-- Bloco: Seção de filtros -->
<div id="filter-section" class="d-none">
  <form method="get" class="mb-4 p-3 bg-light rounded shadow-sm">
    <div class="row g-2 align-items-end">
      {% for field in fields_config %}
  {% if field.filterable %}
    <div class="col-12 col-md-4">

      {% if field.type != "item_image_url" %}
      <label class="form-label">{{ field.label }}</label>
      {% endif %}

      {% if field.id == "item_image_url" %}
  <div class="col-md-6 mb-3">
    <label class="form-label d-block">Imagem:</label>

    <div class="form-check">
      <input class="form-check-input" type="radio" name="item_image_url" value="" id="filter_image_any"
             {% if request.args.get('item_image_url') in [None, ''] %}checked{% endif %}>
      <label class="form-check-label" for="filter_image_any">Qualquer</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" name="item_image_url" value="True" id="filter_image_yes"
             {% if request.args.get('item_image_url') == 'True' %}checked{% endif %}>
      <label class="form-check-label" for="filter_image_yes">Com imagem</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" name="item_image_url" value="False" id="filter_image_no"
             {% if request.args.get('item_image_url') == 'False' %}checked{% endif %}>
      <label class="form-check-label" for="filter_image_no">Sem imagem</label>
    </div>
  </div>





      {% elif field.type in ["text", "item_custom_id", "item_description", "item_obs"] %}
        <input type="text" name="{{ field['id'] }}" class="form-control"
               value="{{ request.args.get(field['id'], '') }}" placeholder="Buscar {{ field.label }}">

      {% elif field.type == "number" %}
        <div class="input-group">
          <input type="number" step="0.01" name="min_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('min_' + field['id'], '') }}" placeholder="Mín.">
          <input type="number" step="0.01" name="max_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('max_' + field['id'], '') }}" placeholder="Máx.">
        </div>
        <p>Min. e Max.</p>

        {% elif field.type == "item_value" %}
        <div class="input-group">
          <input type="number" step="0.01" name="min_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('min_' + field['id'], '') }}" placeholder="Mín.">
          <input type="number" step="0.01" name="max_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('max_' + field['id'], '') }}" placeholder="Máx.">
        </div>
        <p>Min. e Max.</p>

        {% elif field.type == "value" %}
        <div class="input-group">
          <input type="number" step="0.01" name="min_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('min_' + field['id'], '') }}" placeholder="Mín.">
          <input type="number" step="0.01" name="max_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('max_' + field['id'], '') }}" placeholder="Máx.">
        </div>
        <p>Min. e Max.</p>


      {% elif field.type == "date" %}
        <div class="input-group">
          <input type="date" name="start_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('start_' + field['id'], '') }}">
          <input type="date" name="end_{{ field['id'] }}" class="form-control"
                 value="{{ request.args.get('end_' + field['id'], '') }}">
        </div>

      {% elif field.type == "dropdown" and field.options %}
        <select name="{{ field['id'] }}" class="form-select">
          <option value="">Todos</option>
          {% for opt in field.options %}
            <option value="{{ opt }}" {% if request.args.get(field['id']) == opt %}selected{% endif %}>
              {{ opt }}
            </option>
          {% endfor %}
        </select>
      {% endif %}
    </div>
  {% endif %}
{% endfor %}


      <div class="col-12 col-md-2">
        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
      </div>

      <div class="col-12 col-md-2">
        <a href="{{ request.path }}" class="btn btn-outline-secondary w-100">Limpar filtros</a>
      </div>

    </div>
  </form>
</div>

<script>
  function toggleFilters(event) {
    event.preventDefault();
    const filterSection = document.getElementById('filter-section');
    if (filterSection) {
      filterSection.classList.toggle('d-none');
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    const urlParams = new URLSearchParams(window.location.search);
    const hasFilters = ['description', 'valor', 'comments', 'item_custom_id'].some((param) => urlParams.has(param));
    if (hasFilters) {
      const filterSection = document.getElementById('filter-section');
      if (filterSection) filterSection.classList.remove('d-none');
    }
  });
</script>
